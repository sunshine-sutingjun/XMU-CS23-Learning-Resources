(self.webpackChunklms=self.webpackChunklms||[]).push([[81573],{685795:function(e,i,t){var r=t(496486),s=t(383228);t(682772),t(788674),t(132023),t(323123),t(454747),e.exports=["$rootScope","toastr","activityApi",function(e,i,t){var o="module",n="syllabus",u=["web_link","material","homework","forum","online_video","slide","lesson","exam","chatroom","questionnaire","page","scorm","interaction","vocabulary","virtual_experiment","h5_courseware"],a=[],c=[],l=[],d=[],v=[],p=[],m=[],f=[],y=null,h=!1,b={},_=function(e,i){return i.every((i=>e.includes(i)))},g=function(e,i){return e.filter((function(e){return i.every((i=>e!==i))}))},A=function(e){var i=[];return e.forEach((function(e){i.includes(e)||i.push(e)})),i},S=function(e,i){var t="activity"===e?"".concat(i.type,"-").concat(i.id):i.id,r=!1;switch(e){case o:r=!m.includes(t)&&d.includes(t);break;case n:r=!f.includes(t)&&v.includes(t);break;default:r=p.includes(t)}return r},I=function(e,i){var t=!0;switch(e){case o:t=m.includes(i);break;case n:t=f.includes(i);break;default:t=!u.includes(i)}return t},x=function(e){return!(null!=e&&e.published)},C=function(e){var i=y[o+e].syllabusIds,t=y[o+e].activityKeys;_(v,i)&&_(p,t)&&(d.push(e),h=_(d,a))},k=function(){h=!1,d=[],v=[],p=[]},w=function(e){return"scheduled"!==e.type||e.startTime?e.startTime&&e.endTime&&e.endTime<=e.startTime?(e.endTimeError=!0,e.startTimeError=!1,!1):(e.endTimeError=!1,!0):(e.startTimeError=!0,!1)},E=function(e,i){i.forEach((function(i){var t=i.split("-"),r=t[0],s=Number(t[1]);"exam"===r?e.exam_ids.push(s):"classroom"!==r&&"feedback"!==r&&e.activity_ids.push(s)}))},M=(i,t,r)=>i?t?e.$t("activityPublish.batchPublishedMsg",[r]):e.$t("activityPublish.publishedMsg"):t?e.$t("activityPublish.batchUnpublishMsg",[r]):e.$t("activityPublish.unpublishedMsg"),P=function(r,s,o){var n=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];if(!s||0===s.length||!w(o))return Promise.resolve();var u={published:o.type,activity_ids:[],exam_ids:[]};return E(u,s),new Promise((s=>{t.publishActivities(r,u,(function(t){k(),i.success(M(u.published,n,t.updated_count)),e.$emit("activity-publish-changed",u),s()}))}))},T=function(){return h},F=function(e){return e&&(e.startTimeError=!1,e.endTimeError=!1),s("#activity-publisher").foundation("reveal","close")};return{toggleSetting:function(e,i){var t;i?(t=e.course.modules,y||(y={},t.forEach((function(e){a.push(e.id);var i=[],t=[];e.syllabuses.forEach((function(e){c.push(e.id);var s=r.filter(e.activities,(e=>u.includes(e.type)));if(s.length>0){t.push(e.id);var o=r.map(s,(e=>"".concat(e.type,"-").concat(e.id)));l=l.concat(o),y[n+e.id]=o,i=i.concat(o)}else f.push(e.id)}));var s=r.filter(e.activities,(e=>u.includes(e.type)));s.length>0||t.length>0?(moduleActivityKeys=r.map(s,(e=>"".concat(e.type,"-").concat(e.id))),l=l.concat(moduleActivityKeys),y[o+e.id]={syllabusActivityKeys:i,syllabusIds:t,activityKeys:moduleActivityKeys}):m.push(e.id)})),l=A(l))):(k(),e.checkedActivities=[],e.publishSetting.startTimeError=!1,e.publishSetting.endTimeError=!1)},checkActivity:function(e,i){return(p=[]).push("".concat(i.type,"-").concat(i.id)),e.checkedActivities=p,e.publishSetting.type=x(i),P(e.course.id,p,e.publishSetting,!1).then((()=>p))},publishActivies:P,checkOption:function(e,i,t){var r=t?"".concat(t.type,"-").concat(t.id):null;return A(r?function(e,i,t){if(p.includes(t))return p=g(p,[t]),i&&(v=g(v,[i])),d=g(d,[e]),h=!1,p;if(p.push(t),i){var r=y[n+i];_(p,r)&&v.push(i)}return C(e),p}(e,i,r):i?function(e,i){var t=y[n+i];return v.includes(i)?(p=g(p,t),v=g(v,[i]),d=g(d,[e]),h=!1,p):(v.push(i),p=p.concat(t),C(e),p)}(e,i):function(e){var i=[];i=(i=y[o+e].syllabusActivityKeys).concat(y[o+e].activityKeys);var t=y[o+e].syllabusIds;return d.includes(e)?(p=g(p,i),v=g(v,t),d=g(d,[e]),h=!1,p):(p=p.concat(i),v=v.concat(t),d.push(e),h=_(d,a),p)}(e))},resetCheckedOptions:k,checkAllOption:function(e){return h?k():(h=!0,d=a,v=c,p="all"!==e?l.filter((i=>i.split("-")[0]===e)):l),p},openPublishPopup:function(){return s("#activity-publisher").foundation("reveal","open")},initPublisher:function(e){b={type:!0},e.publishSetting=b,e.checkedActivities=[],e.closeActivityPublishPopup=F,e.allOptionChecked=T,e.optionChecked=S,e.disabledCheck=I,e.needPublish=x},closePublishPopup:F,enabledActivityTypes:u,canViewActivityPermission:function(e,i){return!!i&&(!!e||(!u.includes(i.type)||!!i.published&&!!i.is_in_progress))},updateActivitiesPublishType:function(e,i){r(e).forEach((function(e){("exam"===e.type&&-1!==i.exam_ids.indexOf(e.id)||"exam"!==e.type&&-1!==i.activity_ids.indexOf(e.id))&&(e.published=i.published,r.isEmpty(i.published)&&(e.publish_time=""))}))},allowViewUnpublishedActivityDetail:e=>["exam","homework","forum","questionnaire"].includes(null==e?void 0:e.type)}}]},33614:function(e,i,t){var r=t(496486),s=t(261139),o=t(730381),n=t(383228),u=t(993776);t(491038),t(702707),t(140561),t(556977),t(132023),t(115306),t(454747);var a=t(887757);function c(e,i,t,r,s,o,n){try{var u=e[o](n),a=u.value}catch(e){return void t(e)}u.done?i(a):Promise.resolve(a).then(r,s)}function l(e,i){return function(e){if(Array.isArray(e))return e}(e)||function(e,i){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var t=[],r=!0,s=!1,o=void 0;try{for(var n,u=e[Symbol.iterator]();!(r=(n=u.next()).done)&&(t.push(n.value),!i||t.length!==i);r=!0);}catch(e){s=!0,o=e}finally{try{r||null==u.return||u.return()}finally{if(s)throw o}}return t}(e,i)||v(e,i)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function d(e,i){var t;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(t=v(e))||i&&e&&"number"==typeof e.length){t&&(e=t);var r=0,s=function(){};return{s:s,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:s}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,n=!0,u=!1;return{s:function(){t=e[Symbol.iterator]()},n:function(){var e=t.next();return n=e.done,e},e:function(e){u=!0,o=e},f:function(){try{n||null==t.return||t.return()}finally{if(u)throw o}}}}function v(e,i){if(e){if("string"==typeof e)return p(e,i);var t=Object.prototype.toString.call(e).slice(8,-1);return"Object"===t&&e.constructor&&(t=e.constructor.name),"Map"===t||"Set"===t?Array.from(e):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?p(e,i):void 0}}function p(e,i){(null==i||i>e.length)&&(i=e.length);for(var t=0,r=new Array(i);t<i;t++)r[t]=e[t];return r}t(535666);var m=t(117403).default;e.exports=["$http","activityApi","$q","Course","toastr","commonApi",function(e,i,t,v,p){var f={},y={},h={},b={},_=null,g=null,A=null,S=null,I=null,x=null,C=null,k=null,w=null,E=null,M=null,P=null,T={},F={},q=null,R=null,j=null,L=null,H=null,D={},O=function(e){var i=1;return r.each(e,(e=>(e.sort=i,i++))),e},B=function(e,i,t){var o=r.sortBy(t,"sort"),n=s.copy(o[e]);o.splice(e,1),o.splice(i,0,n);var u=1;return r.each(o,(function(e){return e.sort=u,u++})),o},U=function(){return f={},y=null},V=(e,i)=>(()=>{var t,s=[],o=d(i.modules);try{for(o.s();!(t=o.n()).done;){var n,u=t.value,a=d(u.directActivities);try{for(a.s();!(n=a.n()).done;){var c=n.value;c.prerequisites&&c.prerequisites.length>0&&r.remove(c.prerequisites,(i=>i.activity_id===e.id&&i.activity_type===e.type))}}catch(e){a.e(e)}finally{a.f()}s.push(u.syllabuses.map((i=>(()=>{var t,s=[],o=d(i.activities);try{for(o.s();!(t=o.n()).done;){var n=t.value;n.prerequisites&&n.prerequisites.length>0?s.push(r.remove(n.prerequisites,(i=>i.activity_id===e.id&&i.activity_type===e.type))):s.push(void 0)}}catch(e){o.e(e)}finally{o.f()}return s})())))}}catch(e){o.e(e)}finally{o.f()}return s})(),$="unpublished",K="scheduled";var Q={course:{},_course:null,fillActivitiesInModuleAndSyllabus:(e,i)=>r.map(i,(function(i){i.readType="learning_activity";var t,s=!1,o=d(e.course.activities);try{for(o.s();!(t=o.n()).done;){var n=t.value;n.id===i.id&&n.type===i.type&&(s=!0)}}catch(e){o.e(e)}finally{o.f()}if(!s){var u=e.getModule(i.module_id);if(e.course.activities.push(i),!u)return;if(u.activities.push(i),!i.syllabus_id)return void u.directActivities.push(i);var a=r.find(u.syllabuses,{id:i.syllabus_id});if(a)return a.activities.push(i)}})),fillExamsInModuleAndSyllabus(e,i,t){var s=e.getSyllabuses();return r.each(i,(function(i){var o,n=!1;i.type="exam",i.readType="exam_activity",i.has_make_up=(o=i.make_up_record)&&o.is_processing&&!o.has_submitted;var u,a=d(e.course.activities);try{for(a.s();!(u=a.n()).done;){var c=u.value;c.id===i.id&&c.type===i.type&&(n=!0)}}catch(e){a.e(e)}finally{a.f()}if(!n){var l;if(e.course.activities.push(i),"module"===i.referrer_type&&!t)return i.module_id=i.referrer_id,(l=r.find(e.course.modules,{id:i.referrer_id})).activities.push(i),l.directActivities.push(i);if("syllabus"===i.referrer_type){var v=r.find(s,{id:i.referrer_id});if(v)return l=e.getModule(v.module_id),i.module_id=l.id,i.syllabus_id=v.id,v.activities.push(i),l.activities.push(i)}}}))},fillLiveRecordsInModule:(e,i)=>r.map(i,(function(i){i.type="live_record";var t,r=!1,s=d(e.course.activities);try{for(s.s();!(t=s.n()).done;){var o=t.value;o.id===i.id&&o.type===i.type&&(r=!0)}}catch(e){s.e(e)}finally{s.f()}if(!r){var n=e.getModule(i.module_id);if(e.course.activities.push(i),!n)return;return n.activities.push(i),n.directActivities.push(i)}})),fillInClassInteractionsInModule(e,i){var t={select_student:"选人",select_group:"选人",race_answer:"抢答"};return r.each(i,(function(i){if(i.unique_key="".concat(i.type,"-").concat(i.id),!r.find(e.course.activities,{id:i.id,type:i.type})&&i.module_id){var s=e.getModule(i.module_id);if(e.course.activities.push(i),!s)return;return s.activities=s.activities||[],s.directActivities=s.directActivities||[],i.sort=r.maxBy(s.activities,"sort")+1,i.title=t[i.type],s.activities.push(i),s.directActivities.push(i)}}))},fillRollCallInModule(e,i){var t={number_rollcall:"数字点名",qr_rollcall:"二维码点名"};return r.each(i,(function(i){if(i.type="".concat(i.source,"_rollcall"),i.unique_key="".concat(i.type,"-").concat(i.id),i.inclass_type="".concat(i.source,"-rollcall"),!r.find(e.course.activities,{id:i.id,type:i.type})){var s=e.getModule(i.module_id);if(e.course.activities.push(i),!s)return;return s.activities=s.activities||[],s.directActivities=s.directActivities||[],i.sort=r.maxBy(s.activities,"sort")+1,i.title=t[i.type],"waiting"!==i.status&&(i.start_time=i.rollcall_time),s.activities.push(i),s.directActivities.push(i)}}))},fillClassroomsInModuleAndSyllabus(e,i,t){var s=e.getSyllabuses();return r.each(i,(function(i){i.readType="classroom_activity";var o,n=!1,u=d(e.course.activities);try{for(u.s();!(o=u.n()).done;){var a=o.value;a.id===i.id&&a.type===i.type&&(n=!0)}}catch(e){u.e(e)}finally{u.f()}if(!n){var c;if(e.course.activities.push(i),!i.module_id)return;if(i.syllabus_id){var l=r.find(s,{id:i.syllabus_id});if(l)return c=e.getModule(l.module_id),l.activities.push(i),c.activities.push(i)}else if(!t&&(c=r.find(e.course.modules,{id:i.module_id})))return c.directActivities.push(i),c.activities.push(i)}}))},initQuestionnaire(i){var r=F[i];if(r)return r.promise;F[i]=r=t.defer();return e.get("/api/questionnaires/".concat(i)).success((e=>r.resolve(e))).error(p.decorateError((()=>r.resolve([])))),r.promise},initCourseAndModules(){if(x)return x.promise;x=t.defer();var e=Q.initCourseInfo(),i=Q.initModules(),r=Q.initCourseTemplateSetting(),s=Q.initActivityPublishSetting();return t.all([e,i,r,s]).then((function(){var e=Array.from(arguments.length<=0?void 0:arguments[0]),i=l(e,4),t=i[0],r=i[1],s=i[2],o=i[3];return t.modules=r,t.templateSetting=s,t.activityPublishSetting=o,Q._course=new v(t),Q._course.sortModules(),Q._course.sortSyllabus(),x.resolve(t)})),x.promise},initCourseTimeTable(i){if(H)return H.promise;H=t.defer();return e.get("/api/courses/".concat(i,"/lesson-timetable")).success((e=>H.resolve(e.timetables))).error(p.decorateError((()=>H.resolve([])))),H.promise},getOnlineVideoUnplayedSegments(i){return(t=a.mark((function t(){var r;return a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.get("/api/online-videos/".concat(i,"/unplayed-segments"));case 2:return r=t.sent,t.abrupt("return",r.data.segments);case 4:case"end":return t.stop()}}),t)})),function(){var e=this,i=arguments;return new Promise((function(r,s){var o=t.apply(e,i);function n(e){c(o,r,s,n,u,"next",e)}function u(e){c(o,r,s,n,u,"throw",e)}n(void 0)}))})();var t},setTimeTableProperty(e,i){e.timetables=i,i.length>0&&(o.locale(n("html").attr("lang")),e.duration="".concat(o(i[0].start_time).format("YYYY.MM.DD")," ").concat(o(i[0].start_time).format("HH:mm"),"-").concat(o(i[0].end_time).format("HH:mm")),e.teachingClasses=e.course_attributes.teaching_class_name.replace(/,/g," / "),e.location=i[0].room.room_name)},initModules(){if(A)return A.promise;A=t.defer();var i=n("#courseId").val();return e.get("/api/courses/".concat(i,"/modules")).success((e=>A.resolve(e.modules))).error(p.decorateError((()=>A.resolve([])))),A.promise},initCourseTemplateSetting(){if(S)return S.promise;if(S=t.defer(),"Student"===n("#userRole").val())S.resolve({});else{var i=n("#courseId").val();e.get("/api/course/".concat(i,"/template-setting")).success((e=>S.resolve(e))).error(p.decorateError((()=>S.resolve([]))))}return S.promise},initActivityPublishSetting(){if(I)return I.promise;I=t.defer();var i=n("#courseId").val();return e.get("/api/course/".concat(i,"/activity-publish-setting")).success((e=>I.resolve(e))).error(p.decorateError((()=>I.resolve({})))),I.promise},initCourseInfo(){var e=n("#courseId").val();if(g)return g.promise;g=t.defer();return i.course(e,"id,name,start_date,end_date,course_code,subject_code,credit,course_attributes(student_count, teaching_class_name,practice_hours,data),academic_year,semester,public_scope,learning_mode,teaching_mode,score_published,students_count,compulsory, syllabus_enabled,imported_from,course_type,audit_status,display_name,classroom_schedule,second_name,department(id,code,name), grade(id,name),klass(id,name),instructors(id,user_no,email,avatar_big_url,avatar_small_url,name,portfolio_url),is_blocked, org(is_enterprise_or_organization,is_transfer_arrears)",(function(e){return Q.course=e,e.activities=e.activities||[],g.resolve(e)}),(()=>g=null)),g.promise},initCourse(e,r){if(_)return _.promise;_=t.defer();var s=function(e){return Q.course=e,e.activities=e.activities||[],Q._course=new v(e),Q._course.sortModules(),Q._course.sortSyllabus(),_.resolve(Q.course)},o=n("#courseId").val(),u="id,name,sort,syllabuses(".concat("id,date,summary,syllabus_id,objective,comments,module_id",")"),a="id,name,department(code,name),grade(name),klass(name), instructors(id,avatar_big_url,name),modules(".concat(u,"), course_code,subject_code,course_attributes(student_count), public_scope,learning_mode,teaching_mode,score_published,syllabus_enabled,imported_from"),c=e||a;return r?i.anonymousCourse(o,c,s,(function(){})):i.course(o,c,s,(()=>_=null)),_.promise},getActivitiesByModuleIds(e,t,r){var s=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];return i.getActivitiesByModuleIds(e,t,r,s)},getCourseSyllabuses:()=>Q._course.getSyllabuses(),initActivities(i){if(M)return M.promise;M=t.defer();var r=n("#subCourseId").val();return e.get("/api/courses/".concat(i,"/activities?sub_course_id=").concat(r)).success((e=>M.resolve(e.activities))).error(p.decorateError((()=>M.resolve([])))),M.promise},fillAskQuestionsInModuleAndSyllabus(e,i){i.forEach((i=>{if(i.readType="ask_question",i.unique_key="ask_question-".concat(i.id),!e.course.activities.find((e=>e.id===i.id&&e.type===i.type))){e.course.activities.push(i);var t=e.getModule(i.module_id);if(!t)return;if(t.activities.push(i),!i.syllabus_id)return void t.directActivities.push(i);var s=r.find(t.syllabuses,{id:i.syllabus_id});s&&s.activities.push(i)}}))},initAskQuestionForActivityList(i){if(P)return P.promise.then((e=>this.fillAskQuestionsInModuleAndSyllabus(i,e))),P.promise;return P=t.defer(),e.get("/api/courses/".concat(i.id,"/ask-questions")).success((e=>(this.fillAskQuestionsInModuleAndSyllabus(i,e.interactions),P.resolve(e.ask_questions)))),P.promise},deleteAskQuestion(i,t,s,o,n){var u="/api/ask-questions/".concat(i.id);s.keep_original&&(u="".concat(u,"?removed_from_module=true"));return e.delete(u).success(p.decorateSuccess((function(){if(r.map(t.modules,(function(e){return r.remove(e.activities,{id:i.id,type:i.type}),r.remove(e.directActivities,{id:i.id,type:i.type}),r.map(e.syllabuses,(e=>r.remove(e.activities,{id:i.id,type:i.type})))})),s&&s.keep_original){var e=r.find(t.activities,{id:i.id,type:i.type});delete e.module_id,delete e.syllabus_id}else r.remove(t.activities,{id:i.id,type:i.type});return o()}))).error(p.decorateError(n))},initActivitiesForActivityList(e,i){var t=this.initActivities(e.id);return t.then((t=>(r.isEmpty(i)||(t=r.filter(t,(e=>!i.includes(e.type)))),this.fillActivitiesInModuleAndSyllabus(e,t,!0)))),t},initExamsForActivityList(e){if(C)return C.promise.then((i=>this.fillExamsInModuleAndSyllabus(e,i,!0))),C.promise;return C=t.defer(),i.examInCourse(e.id,(i=>(this.fillExamsInModuleAndSyllabus(e,i.exams),C.resolve(i.exams)))),C.promise},initLiveRecordsForActivityList(e){if(k)return k.promise.then((i=>this.fillLiveRecordsInModule(e,i))),k.promise;return k=t.defer(),i.liveRecordInCourse(e.id,(i=>(this.fillLiveRecordsInModule(e,i.live_records),k.resolve(i.live_records)))),k.promise},initInClassInteractionsForActivityList(e){w=t.defer();return i.inclassInteractionInCourse(e,(e=>w.resolve(e.interactions)),(()=>w.resolve([]))),w.promise},initRollCallsForActivityList(e){var r=t.defer();return i.baseRollcallInCourse(e,(e=>r.resolve(e.rollcalls))),r.promise},initExamsForActivityListOnlyRequest(e){var r=t.defer();return i.examInCourse(e,(e=>r.resolve(e.exams)),(()=>r.resolve([]))),r.promise},initLiveRecordsForActivityListOnlyRequest(e){var r=t.defer();return i.liveRecordInCourse(e,(e=>r.resolve(e.live_records)),(()=>r.resolve([]))),r.promise},initClassroomsForActivityList(e){if(E)return E.promise.then((i=>this.fillClassroomsInModuleAndSyllabus(e,i,!0))),E.promise;return E=t.defer(),i.classroomInCourse(e.id,(i=>(this.fillClassroomsInModuleAndSyllabus(e,i.classrooms),E.resolve(i.classrooms)))),E.promise},initClassroomsForActivityListOnlyRequest(e){var r=t.defer();return i.classroomInCourse(e,(e=>r.resolve(e.classrooms)),(()=>r.resolve([]))),r.promise},initCatalogActivityList(e){var r=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(o)return o.promise.then((i=>(this.fillActivitiesInModuleAndSyllabus(e,i.learning_activities),this.fillExamsInModuleAndSyllabus(e,i.exams,!0),this.fillClassroomsInModuleAndSyllabus(e,i.classrooms,!0)))),o.promise;var s=i=>(this.fillActivitiesInModuleAndSyllabus(e,i.learning_activities),this.fillExamsInModuleAndSyllabus(e,i.exams),this.fillClassroomsInModuleAndSyllabus(e,i.classrooms),o.resolve(i)),o=t.defer();return r?i.catalogActivitiesInCourseForVisitor(e.id,s):i.catalogActivitiesInCourse(e.id,s),o.promise},initExams(e){var r=t.defer();return i.examInCourse(e,(e=>r.resolve(e.exams)),(e=>r.reject(e))),r.promise},initExamsSubmitted(e){var r=t.defer();return i.examsSubmitted(e,(e=>r.resolve(e.exam_ids))),t.all([r.promise,this.initExamScores(e)])},initExamsSubmissions(e){var r=t.defer();return i.examSubmissions(e,(e=>r.resolve(e))),r.promise},initExamScores(e){var r=t.defer();return i.examsScores(e,(e=>r.resolve(e.exam_scores)),(e=>r.reject(e))),r.promise},initClassroom(e){E=t.defer();return i.classroomInCourse(e,(e=>E.resolve(e.classrooms)),(e=>E.reject(e))),E.promise},initHomeworkWithPageInfo(e,r){if(f[r.page]&&!r.reloadPage)return f[r.page].promise;f[r.page]=t.defer();return i.homeworksInCourseWithPageInfo(e,r,(e=>f[r.page].resolve(e)),(()=>f[r.page].resolve(null))),f[r.page].promise},initGroupHomeworks(e){if(y[e])return y[e].promise;y[e]=t.defer();return i.groupHomeworksInGroupSet(e,(i=>y[e].resolve(i.homework_activities)),(()=>y[e].resolve(null))),y[e].promise},initGroupExams(e){if(h[e])return h[e].promise;h[e]=t.defer();return i.groupExamsInGroupSet(e,(i=>h[e].resolve(i.exams)),(()=>h[e].resolve(null))),h[e].promise},getGroupSets:(e,t,r)=>i.groupSetsInCourse(e,t,r),initClassroomScores(e){var r=t.defer();return i.classroomScores(e,(e=>r.resolve(e.classroom_scores)),(e=>r.reject(e))),r.promise},initForumActivity(e){var r=t.defer();return i.forumInCourse(e,(e=>r.resolve(e.forum_activities)),(e=>r.reject(e))),r.promise},initForumScores(e){var r=t.defer();return i.forumScores(e,(e=>r.resolve(e.forum_scores)),(e=>r.reject(e))),r.promise},initCourseVirtualExperimentActivity(e){var r=t.defer();return i.courseVirtualExperiments(e,(e=>r.resolve(e.virtual_experiments)),(e=>r.reject(e))),r.promise},initCourseVirtualExperimentScores(e){var r=t.defer();return i.courseVirtualExperimentsScores(e,(e=>r.resolve(e.virtual_experiments_scores)),(e=>r.reject(e))),r.promise},initWeblinkActivity(e){var r=t.defer();return i.weblinkInCourse(e,(e=>r.resolve(e.web_link_activities)),(e=>r.reject(e))),r.promise},initWeblinkScores(e){var r=t.defer();return i.weblinkScores(e,(e=>r.resolve(e.web_link_scores)),(e=>r.reject(e))),r.promise},initStudents(e){var r=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(s)return s.promise;var s=t.defer();return i.getStudents(e,(e=>s.resolve(e.students)),r),s.promise},initWeblinkStudentScore(e){var r=t.defer();return i.weblinkStudentScores(e,(e=>r.resolve(e.web_link_scores)),(e=>r.reject(e))),r.promise},initVirtualExperimentScores(e){var r=t.defer();return i.virtualExperimentScores(e,(e=>r.resolve(e.virtual_experiment_scores)),(e=>r.reject(e))),r.promise},autoSave(i,s,o){var n=t.defer();return e.put("/api/course/activities/".concat(o,"/web_link_score"),{student_id:i,score:s}).success((function(e){return n.resolve(e),p.success(e.message)})).error((function(e,i){return n.reject(),400===i?(r.each(e.errors.score,(e=>p.error(e))),n.reject()):p.warning()})),n.promise},initQuestionnaireActivity(e){var r=t.defer();return i.questionnaireInCourse(e,(e=>r.resolve(e.questionnaires)),(e=>r.reject(e))),r.promise},initQuestionnaireScores(e){var r=t.defer();return i.questionnaireScores(e,(e=>r.resolve(e.questionnaire_scores)),(e=>r.reject(e))),r.promise},initInteractionActivity(e){var r=t.defer();return i.interactionInCourse(e,(e=>r.resolve(e.interactions)),(e=>r.reject(e))),r.promise},initInteractionScores(e){var r=t.defer();return i.interactionScores(e,(e=>r.resolve(e.interaction_scores)),(e=>r.reject(e))),r.promise},initActivitiesReadForUser(e){if(q)return q.promise;q=t.defer();return i.getActivitiesReadForUser(e,(e=>q.resolve(e.activity_reads))),q.promise},loadHomeworkSubmissionStatuses(e){if(b[e])return b[e].promise;b[e]=t.defer();return i.getHomeworkSubmissionStatus(e,(i=>b[e].resolve(i))),b[e].promise},loadHomeworkSubmissionsNum(e){var r=t.defer();return i.getHomeworkSubmissionsNum(e,(e=>r.resolve(e.homework_submission_nums))),r.promise},saveActivity(e,t,r,s){var o=function(e){return"homework"===e.type&&U(),r(e)};return t.id?i.updateActivity(t,o,s):i.addActivity(e,t,o,s)},deleteHomework:e=>i.deleteActivity(e,{},(()=>U()),(function(){})),batchDeleteHomeworks:e=>i.deleteActivities(e,{},(()=>U()),(function(){})),removeActivityFromCourse(e,i,t){var s=function(i){return!!i&&(i.id===e&&!["exam","classroom"].includes(i.type))};if(r.map(i.modules,(function(e){return r.remove(e.activities,s),r.remove(e.directActivities,s),r.map(e.syllabuses,(e=>r.remove(e.activities,s)))})),t&&t.keep_original){var o=r.find(i.activities,(i=>i.id===e&&!["exam","classroom"].includes(i.type)));return delete o.module_id,delete o.syllabus_id}return r.remove(i.activities,s)},deleteActivityFromCourse:(e,t,r,s,o)=>i.deleteActivity(e,r,p.decorateSuccess((function(){return Q.removeActivityFromCourse(e.id,t,r),V(e,t),s()})),p.decorateError(o)),deleteClassroom:(i,t,s,o,n)=>e.delete("/api/classrooms/".concat(i.id),{params:s}).success(p.decorateSuccess((function(){if(r.map(t.modules,(function(e){return r.remove(e.activities,{id:i.id,type:i.type}),r.remove(e.directActivities,{id:i.id,type:i.type}),r.map(e.syllabuses,(e=>r.remove(e.activities,{id:i.id,type:i.type})))})),s&&s.keep_original){var e=r.find(t.activities,{id:i.id,type:i.type});delete e.module_id,delete e.syllabus_id}else r.remove(t.activities,{id:i.id,type:i.type});return o()}))).error(p.decorateError(n)),deleteExam:(i,t,s,o,n)=>e.delete("/api/exams/".concat(i.id),{params:s}).success(p.decorateSuccess((function(){if(r.map(t.modules,(function(e){return r.remove(e.activities,{id:i.id,type:"exam"}),r.remove(e.directActivities,{id:i.id,type:"exam"}),r.map(e.syllabuses,(e=>r.remove(e.activities,{id:i.id,type:"exam"})))})),V(i,t),s&&s.keep_original){var e=r.find(t.activities,{id:i.id,type:"exam"});delete e.module_id,delete e.syllabus_id,e.referrer_type,e.referrer_id,t.id}else r.remove(t.activities,{id:i.id,type:"exam"});return o()}))).error(p.decorateError(n)),exchangeSyllabusActivities(e,t,r){if(t!==r){var o=B(t,r,e.activities);e.activities=s.copy(o);var n={id:e.id,activities:o};return i.updateSyllabusActivitiesSort(n,(function(){}),(function(){}))}},justExchangeInsiderModule(e,t,o,n,u){var a=r.sortBy((null==u?void 0:u.activities)||n.directActivities,"sort"),c=r.sortBy(o.fromActivities,"sort"),l=s.copy(c[e]);l.syllabus_id=(null==u?void 0:u.id)||0,a.splice(t,0,l),c.splice(e,1);var d,v=O(a),p=O(c),m=o.oldSyllabus?v:p,f=()=>{},y=()=>{};if(u&&o.oldSyllabus){d=v,u.activities=s.copy(d);var h={id:u.id,activities:d};return i.updateSyllabusActivitiesSort(h,f,y)}d=o.oldSyllabus?p:v,u?u.activities=s.copy(d):n.directActivities=s.copy(m);var b={id:u?u.id:o.oldSyllabus,activities:d},_={id:n.id,activities:m};return i.updateSyllabusActivitiesSort(b,f,y),i.updateModuleActivitiesSort(_,f,y),!0},updateActivitiesAfterExchangeSyllabus(e,i){var t=r.sortBy(e.activities,"sort");t.splice(i,1);var o=O(t);return e.activities=s.copy(o),!0},updateActivitiesAfterExchangeModule(e,i){var t=r.sortBy(e.directActivities,"sort");t.splice(i,1);var o=O(t);return e.directActivities=s.copy(o),!0},exchangeModuleActivities(e,t,r){if(t!==r){var o=B(t,r,e.directActivities);e.directActivities=s.copy(o);var n={id:e.id,activities:o};return i.updateModuleActivitiesSort(n,(function(){}),(function(){}))}},exchangeModuleOrSyllabus(e,t,o,n,u){var a=r.sortBy(o.fromActivities,"sort"),c=s.copy(a[e]);c.syllabus_id=(null==u?void 0:u.id)||0,a.splice(e,1);var l=r.sortBy((null==u?void 0:u.activities)||n.directActivities,"sort");l.splice(t,0,c);var d=O(l),v=O(a),p=o.oldSyllabus?void 0:v,m=o.oldSyllabus?v:void 0,f=u?void 0:d,y=u?d:void 0;u?u.activities=s.copy(y):n.directActivities=s.copy(f);var h={module:{fromActivities:p,toActivities:f,fromId:o.oldModule,toId:n.id},syllabus:{fromActivities:m,toActivities:y,fromId:o.oldSyllabus,toId:null==u?void 0:u.id}};return i.updateModuleOrSyllabusActivitiesSort(h,(()=>{}),(()=>{}))},loadActivity(e){var r=t.defer();return i.getActivity(e,(e=>r.resolve(e)),(()=>r.resolve(null))),r.promise},initActivitiesForStudentCompleteness(e){var r=t.defer();return i.getActivities(e,(e=>r.resolve(e.activities)),(()=>r.resolve([]))),r.promise},getActivitiesForStudentCompleteness(e){return R||(R=t.defer(),this.initActivitiesForStudentCompleteness(e).then((function(e){var i=s.copy(e);return r.each(i,(e=>e.readType="learning_activity")),R.resolve(i)}))),R.promise},getExamsForStudentCompleteness(i){if(j)return j.promise;j=t.defer();return e.get("/api/courses/".concat(i,"/exams?fields=id,type,sort,completion_criterion&no-intercept=true")).success((function(e){return r.each(e.exams,(e=>e.readType="exam_activity")),j.resolve(e.exams)})).error((()=>j.resolve([]))),j.promise},getAllActivitiesForStudentCompleteness(i){if(L)return L.promise;L=t.defer();return e.get("/api/course/".concat(i,"/my-completeness")).success((e=>L.resolve(e))).error((()=>L.resolve({}))),L.promise},getInstrouctsEnrolment(i){var r=t.defer();return e.get("/api/courses/".concat(i,"/educators")).success((e=>r.resolve(e.enrollments))),r.promise},logActivityRead(e,t,r,s){var o=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];window.st&&!window.st.isCanTrack()||i.logActivityRead(e,t||{},r||function(){},s||function(){},o)},logExamActivityRead(e,t,r,s){var o=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];window.st&&!window.st.isCanTrack()||i.logExamActivityRead(e,t||{},r||function(){},s||function(){},o)},getLeftScorePercentage(e){var r=t.defer();return i.getScorePercentages(e,(function(e){var i=new u(e.score_percentage_left);return r.resolve(new u(i.toFixed(1)))})),r.promise},getSubmissionNumber(e){var r=t.defer();return i.getSubmissionNumber(e,(e=>r.resolve(e.number))),r.promise},hasReviewedInterScore(e){var r=t.defer();return i.hasReviewedInterScore(e,(e=>r.resolve(e.has_reviewed))),r.promise},getHomeworkFirstSubmissionTime(e){var r=t.defer();return i.getHomeworkFirstSubmissionTime(e,(e=>r.resolve(e.first_submission_time))),r.promise},isInterReviewStarted(e){var r=t.defer();return i.isInterReviewStarted(e,(e=>r.resolve(e.is_inter_review_started))),r.promise},isIntraReviewStarted(e){var r=t.defer();return i.isIntraReviewStarted(e,(e=>r.resolve(e.is_intra_review_started))),r.promise},isHomeworkExpired(e){var r=t.defer();return i.isHomeworkExpired(e,(e=>r.resolve(e.is_expired))),r.promise},getCompletionCriteriaForType:(e,t,r,s)=>T[e]?T[e].promise:i.getCompletionCriteriaForType(e,t,r,s),getActivityCompletionCriteria:(e,t,r,s)=>i.getActivityCompletionCriteria(e,t,r,s),getActivityPrerequisites:(e,t,r)=>i.getActivityPrerequisites(e,t,r),removeAllDependants:(e,t)=>i.removeAllDependants(e,t,(function(){})),deleteActivityPrerequisite:(e,t,r)=>i.deleteActivityPrerequisite(e,t,r),getUnavailablePrerequisites:(e,t,r)=>i.getUnavailablePrerequisites(e,t,r),getActivityHasDependents:(e,t,r)=>i.getActivityHasDependents(e,t,r),getActivitiesHaveDependents:(e,t,r)=>i.getActivitiesHaveDependents(e,t,r),getActivityObeWeight:(e,t,r,s,o)=>i.getActivityObeWeight(e,t,r,s,o),checkUserIsCoreTeamLeader:e=>i.isCoreTeamLeader(e),getActivityUploadsLicenseInfo:(e,t,r)=>i.getActivityUploadsLicenseInfo(e,t,r),getNotLoadedModuleId(e){var i=[];return e.forEach((e=>{D[e]||i.push(e)})),i},setLoadedModuleId(e){e.forEach((e=>D[e]=!0))},setDefaultPublishInfoForScope(e){var i;if(e.publish_type=$,e.publishStatusClass="publish-type-button unpublished",e.publishTypeText=m.t("activityPublishSetting.unpublished"),e.isPublishScheduled=!1,e.hideTag=!1,null!==(i=e.course)&&void 0!==i&&i.activityPublishSetting&&e.activityType){var t=e.activityType.toLowerCase();t=["homework","exam","forum"].includes(t)?t:"others",defaultStatus=e.course.activityPublishSetting[t],e.hideTag="published"===defaultStatus}},setPublishInfoForActivity(e){e&&(e.publishStatusClass=e.is_in_progress?"publish-type-button published":"publish-type-button unpublished",e.publishTypeText=function(e){return e.publish_type?m.t("activityPublishSetting.".concat(e.publish_type)):e.is_in_progress?m.t("activityPublishSetting.published"):m.t("activityPublishSetting.unpublished")}(e),e.isPublishScheduled=e.publish_type===K,e.publishScheduledDuration=function(e){var i="YYYY-MM-DD HH:mm:ss",t=o(e.start_time).format(i),r=e.end_time?o(e.end_time).format(i):m.t("alwaysAvaliable");return"".concat(m.t("activityPublishSetting.scheduledPublishTime"),": ").concat(t," ～ ").concat(r)}(e))},initPublishInfoForActivities(e){e.forEach((e=>{this.setPublishInfoForActivity(e)}))},initPublishInfo(e,i){(!(arguments.length>2&&void 0!==arguments[2])||arguments[2])&&this.setDefaultPublishInfoForScope(e),this.setPublishInfoForActivity(i)},loadActivityDeleteCheck(e,r){var s=t.defer();return i.activityDeleteCheck(e,r,(e=>s.resolve(e))),s.promise},getActivityReadCount:(e,t,r)=>i.getActivityReadCount(e,t,r)};return Q}]}}]);