(self.webpackChunklms=self.webpackChunklms||[]).push([[80557],{684266:function(e,t,n){var a=n(370538).default,r=n(635224);a.filter("datetime",r.datetime())},204045:function(e,t,n){"use strict";n.r(t);n(788674);var a=n(370538),r=n(866473),o=n.n(r),i=n(709564),l=n(450509),s=n.n(l)(),c=n(551900),u=(0,c.Z)(s,(function(){var e=this,t=e.$createElement;return(e._self._c||t)("Poptip",{attrs:{trigger:e.trigger,title:e.popTitle,content:e.content,placement:e.placement}},[e._t("default")],2)}),[],!1,null,null,null).exports,d=n(555288),p=n.n(d)(),f=(0,c.Z)(p,(function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",[n("div",{staticClass:"preview-container"},[e.uploadUrl?n("img",{staticClass:"preview-image",attrs:{src:e.uploadUrl}}):e._e(),e._v(" "),n("div",{staticClass:"preview-overlay"}),e._v(" "),n("div",{staticClass:"upload-operator"},[n("Icon",{attrs:{type:"md-create"},on:{click:e.openUpload}}),e._v(" "),n("Icon",{attrs:{type:"md-trash"},on:{click:e.removeUpload}})],1)]),e._v(" "),n("Upload",{directives:[{name:"show",rawName:"v-show",value:!e.uploadUrl,expression:"!uploadUrl"}],ref:"uploadRef",attrs:{type:"drag",accept:"image/*",format:e.fileFormat,"on-format-error":e.onFormatError,"max-size":e.fileMaxSize,"on-exceeded-size":e.onExceededSize,action:"#"}},[n("Icon",{attrs:{type:"ios-add"}})],1)],1)}),[],!1,null,"11327161",null).exports,v=n(477037),m=n.n(v)(),h=(0,c.Z)(m,(function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("Poptip",{ref:"popTip",attrs:{id:"popover-settings",placement:e.placement,width:"400",padding:"14px 12px"},model:{value:e.visible,callback:function(t){e.visible=t},expression:"visible"}},[n("a",{staticClass:"button button-green small"},[e._v(e._s(e.buttonLabel))]),e._v(" "),n("template",{slot:"content"},[n("Tabs",{attrs:{type:"card",animated:!1}},[n("TabPane",{attrs:{label:e.basicLabel}},[n("ul",[n("li",[n("Checkbox",{on:{"on-change":function(t){return e.Change("case_sensitive")}},model:{value:e.currentCaseSensitive,callback:function(t){e.currentCaseSensitive=t},expression:"currentCaseSensitive"}},[e._v(e._s(e.caseLabel))])],1),e._v(" "),n("li",[n("Checkbox",{on:{"on-change":function(t){return e.Change("unordered")}},model:{value:e.currentUnordered,callback:function(t){e.currentUnordered=t},expression:"currentUnordered"}},[e._v(e._s(e.unorderedLabel))])],1)])]),e._v(" "),e.calculateLabel?n("TabPane",{attrs:{label:e.calculateLabel}},[n("ul",[n("li",[n("Checkbox",{on:{"on-change":e.Change}},[e._v("輸入答案範圍")])],1),e._v(" "),n("li",[n("Checkbox",{on:{"on-change":e.Change}},[e._v("限制小數點位數")])],1),e._v(" "),n("li",[n("Checkbox",{on:{"on-change":e.Change}},[e._v("允許誤差值")])],1)])]):e._e(),e._v(" "),n("Icon",{attrs:{slot:"extra",type:"md-close"},on:{click:e.close},slot:"extra"})],1)],1)],2)}),[],!1,null,"2950349a",null).exports,y=n(285256),g=n(74104),b=n(117403),w=(n(738619),n(925706)),_=n(391737),C=(0,w.aZ)({props:{operateMap:{type:Object}},setup(e){var t=document.querySelector("#cornBtn"),n=(0,_.useAngularScope)(t),a=(0,w.iH)([]);return(0,w.YP)((()=>e.operateMap),(e=>{var t;e&&((t=e).ilib&&a.value.push({id:"ilib",name:b.default.t("menu.libraries")}),t.chatRobot&&a.value.push({id:"chatRobot",name:b.default.t("menu.server")}),t.feedback&&a.value.push({id:"feedback",name:b.default.t("menu.feedback")}),t.enableSobot&&a.value.push({id:"enableSobot",name:b.default.t("menu.server")}))})),{menus:a,clickItem:e=>{document.getElementById("zc__sdk__container")&&"enableSobot"===e.id&&(document.getElementById("zc__sdk__container").style.display="block",window.localStorage.setItem("frameStatus","expand")),n.operateCollection(e.id)},clickOutside:()=>{document.getElementById("zc__sdk__container")&&(document.getElementById("zc__sdk__container").style.display="none",window.localStorage.setItem("frameStatus","collapse"))}}}}),x=(0,c.Z)(C,(function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{directives:[{name:"click-outside-el",rawName:"v-click-outside-el",value:e.clickOutside,expression:"clickOutside"}]},[n("Dropdown",{attrs:{placement:"left-end"},scopedSlots:e._u([{key:"list",fn:function(){return[n("DropdownMenu",e._l(e.menus,(function(t){return n("DropdownItem",{key:t.id,staticClass:"menu-item",class:{zhiCustomBtn:"enableSobot"===t.id},nativeOn:{click:function(n){return e.clickItem(t)}}},[e._v("\n          "+e._s(t.name)+"\n        ")])})),1)]},proxy:!0}])},[n("div",{staticClass:"collapse-content"},[n("i",{staticClass:"font font-more"})])])],1)}),[],!1,null,"5366b860",null).exports,k=n(311610),S=n(681423),T=n(951453),D=(0,w.aZ)({props:{operateMap:{type:Object}},components:{SvgIcon:k.Z},setup(e){var t=(0,T.useAiPpt)().initUsage,n=(0,T.useAiPptUsage)(),a=n.remainingTimes,r=n.dailyUsageLimit;return t(),{openPopup:()=>{a.value<=0?S.Z.warning(b.default.t("aiPpt.unavailableTip")):window.open("/ai-ppt")},remainingTimes:a,dailyUsageLimit:r}}}),E=(0,c.Z)(D,(function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"ai-ppt-container",on:{click:e.openPopup}},[n("div",{staticClass:"remaining-tooltip"},[e._v("\n    "+e._s(e.$t("aiPpt.todayAvailableTimes")+": "+e.remainingTimes+" / "+e.dailyUsageLimit)+"\n  ")]),e._v(" "),n("SvgIcon",{attrs:{name:"ai-ppt"}})],1)}),[],!1,null,"9df731be",null).exports,$=n(409669),I=n.n($);window.Vue=a.default,"$url"in a.default.prototype||a.default.use(g.ZP),a.default.use(o()),n(595221),n(684266),a.default.use(n(509429).default),a.default.use(y.default),a.default.customElement(i.default.name,i.default),a.default.customElement(u.name,u),a.default.customElement(f.name,f),a.default.customElement(h.name,h),a.default.customElement("chat-robot",n(632609).Z),a.default.customElement("collapse-operation",x),a.default.customElement("ai-ppt-entrance",E),a.default.customElement("import-chaoxing-score-modal",n(629477).Z),Promise.all([n.e(67728),n.e(19279),n.e(87642),n.e(60250),n.e(112)]).then(n.bind(n,588721)).then((e=>{e.default.i18n=b.default,a.default.customElement("ono-stat-students",e.default)})),a.default.config.productionTip=!1,I().interceptors.request.use((function(e){var t=/^\/api\//.test(e.url);return window.RequestScope&&t&&(e.headers["Request-Scope"]=window.RequestScope),e}))},218544:function(e,t,n){var a=n(370538).default;n(66992),n(333948),Object.defineProperty(a.prototype,"$tt",{get:()=>e=>a.t[e]}),e.exports={name:"translation",props:["keys"],data:()=>({}),computed:{},created(){return a.t||(a.t={}),(()=>{var e=[];for(var t in this.keys){var n=this.keys[t];e.push(a.t[t]=n)}return e})()},install(e){return e.component("translation",this)},render(e){}}},355413:function(e){e.exports={name:"vue-alert",props:["type","message","tile"],data:()=>({}),computed:{},mounted(){},methods:{}}},477037:function(e){e.exports={name:"vue-popover-settings",props:{buttonLabel:{type:String},basicLabel:{type:String},caseLabel:{type:String},unorderedLabel:{type:String},calculateLabel:{type:String},placement:{type:String,default:"right-start"},caseSensitive:{type:Boolean,default:!1},unordered:{type:Boolean,default:!1}},data(){return{visible:!1,currentCaseSensitive:this.caseSensitive,currentUnordered:this.unordered}},computed:{},mounted(){},methods:{close(){return this.visible=!1},Change(e){var t={case_sensitive:this.currentCaseSensitive,unordered:this.currentUnordered};this.$emit("settings.changed",{label:e,value:t[e]})}}}},450509:function(e){e.exports={name:"vue-poptip",props:["trigger","popTitle","content","placement"],data:()=>({}),computed:{},mounted(){},methods:{}}},555288:function(e,t,n){n(323123);var a=n(391737).useAngularService,r=function(e){if(this.format.length){var t=e.name.split(".").pop().toLocaleLowerCase();if(!this.format.some((e=>e.toLocaleLowerCase()===t)))return this.onFormatError(e,this.fileList),!1}if(this.maxSize&&e.size>1024*this.maxSize)return this.onExceededSize(e,this.fileList),!1;a("uploadService").uploadFiles([e])[0]};e.exports={name:"vue-upload",props:{uploadId:{type:Number,required:!1},uploadUrl:{type:String,required:!1},fileFormat:{type:Array,default:()=>["jpg","jpeg","png"]},fileMaxSize:{type:Number,default:()=>2e3},onExceededSize:{type:Function,default(){a("toastr").error(this.$i18n.t("signup.form.label.uploadSizeError"))}},onFormatError:{type:Function,default(){a("toastr").error(this.$i18n.t("signup.form.label.uploadFormatError"))}}},data:()=>({}),mounted(){this.overrideChildPost()},methods:{overrideChildPost(){var e=this.$refs.uploadRef;e&&(e.post=r.bind(e))},removeUpload(){this.$emit("remove-upload",this.uploadId)},openUpload(){var e=this.$refs.uploadRef;e&&e.handleClick()}}}},383087:function(e,t,n){"use strict";n.r(t)},509429:function(e,t,n){"use strict";n.d(t,{default:function(){return o}});var a=n(218544),r=n.n(a)(),o=(0,n(551900).Z)(r,undefined,undefined,!1,null,null,null).exports},709564:function(e,t,n){"use strict";n.d(t,{default:function(){return o}});var a=n(355413),r=n.n(a)(),o=(0,n(551900).Z)(r,(function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("Alert",{class:{tile:e.tile},attrs:{type:e.type,"show-icon":""}},[n("span",{domProps:{innerHTML:e._s(e.message)}}),e._v(" "),(e.type,n("i",{staticClass:"font font-alert-warning",class:e.type,attrs:{slot:"icon"},slot:"icon"}))])}),[],!1,null,"3bdb0c2d",null).exports},632609:function(e,t,n){"use strict";n.d(t,{Z:function(){return w}});n(788674),n(573210);var a=n(887757),r=n.n(a),o=(n(535666),n(117403)),i=n(356264),l=(n(141817),n(66992),n(454747),n(333948),n(409669)),s=n.n(l),c=n(496486),u=n.n(c),d=function(e,t,n,a){return new(n||(n=Promise))((function(r,o){function i(e){try{s(a.next(e))}catch(e){o(e)}}function l(e){try{s(a.throw(e))}catch(e){o(e)}}function s(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,l)}s((a=a.apply(e,t||[])).next())}))},p=function(e,t){var n,a,r,o,i={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return o={next:l(0),throw:l(1),return:l(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function l(l){return function(s){return function(l){if(n)throw new TypeError("Generator is already executing.");for(;o&&(o=0,l[0]&&(i=0)),i;)try{if(n=1,a&&(r=2&l[0]?a.return:l[0]?a.throw||((r=a.return)&&r.call(a),0):a.next)&&!(r=r.call(a,l[1])).done)return r;switch(a=0,r&&(l=[2&l[0],r.value]),l[0]){case 0:case 1:r=l;break;case 4:return i.label++,{value:l[1],done:!1};case 5:i.label++,a=l[1],l=[0];continue;case 7:l=i.ops.pop(),i.trys.pop();continue;default:if(!(r=i.trys,(r=r.length>0&&r[r.length-1])||6!==l[0]&&2!==l[0])){i=0;continue}if(3===l[0]&&(!r||l[1]>r[0]&&l[1]<r[3])){i.label=l[1];break}if(6===l[0]&&i.label<r[1]){i.label=r[1],r=l;break}if(r&&i.label<r[2]){i.label=r[2],i.ops.push(l);break}r[2]&&i.ops.pop(),i.trys.pop();continue}l=t.call(e,i)}catch(e){l=[6,e],a=0}finally{n=r=0}if(5&l[0])throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}([l,s])}}};function f(e){return{content:e.message,isReply:e.isReply,type:e.type,recommends:e.data,sessionId:e.sessionId}}function v(e,t){return d(this,void 0,void 0,(function(){var n;return p(this,(function(a){return n={session_id:e,message:t},[2,s().post("/api/user/chat",n)]}))}))}function m(){return d(this,void 0,void 0,(function(){var e,t,n;return p(this,(function(a){switch(a.label){case 0:return[4,s().get("/api/user/chat")];case 1:return e=a.sent(),t=(0,i.camelizeKeys)(e.data),n=[],u().isEmpty(t)||t.forEach((function(e){n.push(f(e))})),[2,n]}}))}))}var h=n(48496);function y(e,t,n,a,r,o,i){try{var l=e[o](i),s=l.value}catch(e){return void n(e)}l.done?t(s):Promise.resolve(s).then(a,r)}function g(e){return function(){var t=this,n=arguments;return new Promise((function(a,r){var o=e.apply(t,n);function i(e){y(o,a,r,i,l,"next",e)}function l(e){y(o,a,r,i,l,"throw",e)}i(void 0)}))}}var b={name:"chat-robot",i18n:o.default,props:{title:{type:String,default:""},welcome:{type:String,default:""}},data(){return{show:!1,text:"",loaded:!1,messages:[{content:this.welcome,isReply:!0,type:"text",recommends:[]}],sessionId:null}},created(){window.addEventListener("chat-robot:open",(()=>{this.show=!0}))},methods:{send(e){var t=this;return g(r().mark((function n(){var a,o,l,s,c;return r().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(0!==e.trim().length){n.next=2;break}return n.abrupt("return");case 2:return a={content:e,isReply:!1,type:"text",recommends:[]},t.messages.push(a),t.text="",n.prev=5,n.next=8,v(t.sessionId,e);case 8:o=n.sent,l=(0,i.camelizeKeys)(o.data),s=f(l),t.messages.push(s),t.sessionId=s.sessionId,n.next=18;break;case 15:n.prev=15,n.t0=n.catch(5),h.Toast.error(null===(c=n.t0.response.data)||void 0===c?void 0:c.message);case 18:t.scrollToBottom();case 19:case"end":return n.stop()}}),n,null,[[5,15]])})))()},recoverChat(){var e=this;return g(r().mark((function t(){var n;return r().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,m();case 2:n=t.sent,e.messages=e.messages.concat(n),n.length>0&&(e.sessionId=n[0].sessionId),e.scrollToBottom();case 6:case"end":return t.stop()}}),t)})))()},onVisibleChange(){var e=this;return g(r().mark((function t(){return r().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e.loaded){t.next=4;break}return t.next=3,e.recoverChat();case 3:e.loaded=!0;case 4:e.show&&e.scrollToBottom();case 5:case"end":return t.stop()}}),t)})))()},scrollToBottom(){this.$nextTick((()=>{var e=document.getElementById("chat-robot-content");e.scrollTop=e.scrollHeight}))},close(){this.show=!1}}},w=(0,n(551900).Z)(b,(function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"chat-popup"},[n("Modal",{attrs:{"class-name":"chat-robot-popup",width:"440px","footer-hide":!0,"mask-closable":!1,scrollable:!1},on:{"on-visible-change":e.onVisibleChange},model:{value:e.show,callback:function(t){e.show=t},expression:"show"}},[n("template",{slot:"header"},[n("i",{staticClass:"font font-chat-robot"}),e._v(" "),n("span",[e._v(e._s(e.title))])]),e._v(" "),n("div",{staticClass:"content",attrs:{id:"chat-robot-content"}},e._l(e.messages,(function(t,a){return n("div",{key:a,staticClass:"message-card"},[n("div",{class:t.isReply?"robot-message":"user-message"},[n("div",{staticClass:"message-content"},[n("div",{style:t.isReply?"":"text-align:right;display: flex;flex-direction:row-reverse"},["text"===t.type?n("div",{staticClass:"message-body"},[e._v("\n                "+e._s(t.content)+"\n              ")]):n("div",{staticClass:"recommend-body"},[n("span",{staticClass:"recommend-tooltip"},[e._v(e._s(e.$t("ChatRobot.recommendTip")))]),e._v(" "),e._l(t.recommends,(function(t,a){return n("a",{key:"rec"+a,staticClass:"recommend-item",on:{click:function(n){return e.send(t)}}},[e._v("\n                  "+e._s(t)+"\n                ")])}))],2)])])])])})),0),e._v(" "),n("div",{staticClass:"input"},[n("Input",{attrs:{type:"textarea",border:!1},on:{"on-enter":function(t){return e.send(e.text)}},model:{value:e.text,callback:function(t){e.text=t},expression:"text"}}),e._v(" "),n("Button",{staticClass:"submit",on:{click:function(t){return e.send(e.text)}}},[e._v(e._s(e.$t("ChatRobot.send")))])],1)],2)],1)}),[],!1,null,"456b3ae8",null).exports},374929:function(e,t,n){"use strict";n.d(t,{Z:function(){return s}});var a=n(925706),r=n(866473),o=n(966309),i=n(117403),l=(0,a.aZ)({i18n:i.default,components:{Select:r.Select,Option:r.Option},props:{tags:{type:Array},value:{type:Number}},setup:function(e,t){var n=(0,o.NCN)(e,"value",t.emit,{eventName:"input",passive:!0});return(0,a.YP)(n,(function(e){window.dispatchEvent(new CustomEvent("calendar-tag-change",{detail:e}))})),(0,a.YP)((function(){return e.tags}),(function(){var t;(null===(t=e.tags)||void 0===t?void 0:t.length)&&!n.value&&(n.value=e.tags[0].id)})),{selectedColor:(0,a.Fl)((function(){var t,a=null===(t=e.tags)||void 0===t?void 0:t.find((function(e){return e.id===n.value}));return null==a?void 0:a.color})),tagId:n}}}),s=(0,n(551900).Z)(l,(function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("Select",{staticClass:"calendar-color-select",attrs:{transfer:""},model:{value:e.tagId,callback:function(t){e.tagId=t},expression:"tagId"}},[e.selectedColor?n("div",{staticClass:"legend selected-dot",style:{backgroundColor:e.selectedColor},attrs:{slot:"prefix"},slot:"prefix"}):e._e(),e._v(" "),e._l(e.tags,(function(t){return n("Option",{key:t.id,attrs:{value:t.id,label:t.name}},[n("span",{staticClass:"legend",style:{backgroundColor:t.color}}),e._v(" "),n("span",[e._v(e._s(t.name))])])}))],2)}),[],!1,null,"1fb191b6",null).exports},235639:function(e,t,n){"use strict";n.d(t,{Z:function(){return Be}});n(141817),n(66992),n(747042),n(319601),n(788674),n(132023),n(333948);var a,r,o=n(925706),i=n(730381),l=n(168680),s=n(920976),c=n(966309),u=n(409669),d=n.n(u),p=n(356264),f=(n(323123),n(413447)),v=n(247251),m=n(920556),h=(n(339714),n(730854)),y=function(e,t){var n=(0,h.$_Y)(e);return n?(n.opacity=t,n.rgb().toString()):e},g=["#FBDB3C","#93BA1E","#28BD6E","#20BEC8","#4892F6","#7A4714","#5878B4","#6024E0","#C225E5","#F85353"],b=(a=function(e,t){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}a(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),w=function(e,t,n,a){var r,o=arguments.length,i=o<3?t:null===a?a=Object.getOwnPropertyDescriptor(t,n):a;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,n,a);else for(var l=e.length-1;l>=0;l--)(r=e[l])&&(i=(o<3?r(i):o>3?r(t,n,i):r(t,n))||i);return o>3&&i&&Object.defineProperty(t,n,i),i},_=function(){function e(){this.uploads=[]}return Object.defineProperty(e.prototype,"isOwner",{get:function(){var e,t;return this.createdBy.id===(null===(t=null===(e=window.globalData)||void 0===e?void 0:e.user)||void 0===t?void 0:t.id)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"multiDay",{get:function(){return i(this.endTime).diff(this.startTime,"day",!0)>1},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"color",{get:function(){var e,t;return this.isOwner?null!==(t=null===(e=this.tag)||void 0===e?void 0:e.color)&&void 0!==t?t:this.legacyColor:g[4]},enumerable:!1,configurable:!0}),w([(0,f.C)({name:"all_day"})],e.prototype,"allDay",void 0),w([(0,f.C)({name:"start_time"})],e.prototype,"startTime",void 0),w([(0,f.C)({name:"end_time"})],e.prototype,"endTime",void 0),w([(0,f.C)({name:"target_type"})],e.prototype,"targetType",void 0),w([(0,f.C)({name:"target_data"})],e.prototype,"targetData",void 0),w([(0,f.C)({name:"alert_id"})],e.prototype,"alertId",void 0),w([(0,f.C)({name:"send_alert_email"})],e.prototype,"sendAlertEmail",void 0),w([(0,f.C)({name:"created_by"})],e.prototype,"createdBy",void 0),w([(0,f.C)({name:"color"})],e.prototype,"legacyColor",void 0),e}(),C=function(){function e(){}return Object.defineProperty(e.prototype,"multiDay",{get:function(){return i(this.endTime).diff(this.startTime,"day",!0)>1},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isOwner",{get:function(){var e,t;return this.createdBy.id===(null===(t=null===(e=window.globalData)||void 0===e?void 0:e.user)||void 0===t?void 0:t.id)},enumerable:!1,configurable:!0}),e.prototype.duration=function(e){return void 0===e&&(e="millisecond"),i(this.endTime).diff(i(this.startTime),e)},w([(0,f.C)({name:"course_id"})],e.prototype,"courseId",void 0),w([(0,f.C)({name:"course_title"})],e.prototype,"courseTitle",void 0),w([(0,f.C)({name:"start_time"})],e.prototype,"startTime",void 0),w([(0,f.C)({name:"end_time"})],e.prototype,"endTime",void 0),w([(0,f.C)({name:"repeat_type"})],e.prototype,"repeatType",void 0),w([(0,f.C)({name:"repeat_frequency"})],e.prototype,"repeatFrequency",void 0),w([(0,f.C)({name:"repeat_weekly_days"}),(0,v.w)((function(e){var t=e.value;switch(e.type){case m.h.PLAIN_TO_CLASS:return t?t.split(",").map((function(e){return Number(e)})):[];case m.h.CLASS_TO_PLAIN:return t.join(",");default:return t}}))],e.prototype,"repeatWeeklyDays",void 0),w([(0,f.C)({name:"repeat_end_date"})],e.prototype,"repeatEndDate",void 0),w([(0,f.C)({name:"instructors_names"})],e.prototype,"instructorsNames",void 0),w([(0,f.C)({name:"created_by"})],e.prototype,"createdBy",void 0),e}(),x=function(e,t,n,a,r,o,i,l,s,c){this.id=e,this.title=t,this.backgroundColor=n,this.borderColor=a,this.dotColor=r,this.start=o,this.end=i,this.allDay=l,this.className=s,this.extendedProps=c},k=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return b(t,e),t.fromEvent=function(e){var n=e.isOwner?e.color:g[4];return new t("".concat(t.type,"-").concat(e.id),e.title,y(n,.4),y(n,.4),n,e.startTime,e.endTime,e.allDay,"hollow",{data:e,type:t.type})},t.type="event",t}(x),S=function(e){function t(t,n,a,r,o,i,l,s,c,u,d,p,f,v,m,h,y){var g=e.call(this,t,n,a,r,o,i,l,s,c,u)||this;return g.startTime=d,g.endTime=p,g.startRecur=f,g.endRecur=v,g.daysOfWeek=m,g.duration=h,g.rrule=y,g}return b(t,e),t.fromTimetable=function(e){var n,a=new t("".concat(t.type,"-").concat(e.id),e.courseTitle,y(e.color,.4),y(e.color,.4),e.color,e.startTime,e.endTime,!1,"",{data:e,type:t.type});if("no_repeat"===e.repeatType)return a;var r,o=(n={rrule:"day"===(r=e).repeatType?{freq:"daily",dtstart:r.startTime,until:i.utc(r.repeatEndDate).endOf("day").toISOString()}:{freq:"weekly",interval:r.repeatFrequency,byweekday:r.repeatWeeklyDays.map((function(e){return e-1})),dtstart:r.startTime,until:i.utc(r.repeatEndDate).endOf("day").toISOString()},duration:r.duration()}).rrule,l=n.duration;return a.rrule=o,a.duration=l,a},t.type="timetable",t}(x);!function(e){e.system="system",e.custom="custom"}(r||(r={}));var T,D,E=function(){function e(){this.source=r.custom,this.editable=!0,this.states={checked:!0}}return e.fromObj=function(t){var n=new e;return Object.assign(n,t),n},e.prototype.check=function(){this.states.checked=!0},e.prototype.uncheck=function(){this.states.checked=!1},Object.defineProperty(e.prototype,"isTimetable",{get:function(){return!1===this.editable&&this.source===r.system},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"checked",{get:function(){return this.states.checked},set:function(e){this.states.checked=e},enumerable:!1,configurable:!0}),e}(),$=function(){},I=function(){},O=function(e,t,n,a){return new(n||(n=Promise))((function(r,o){function i(e){try{s(a.next(e))}catch(e){o(e)}}function l(e){try{s(a.throw(e))}catch(e){o(e)}}function s(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,l)}s((a=a.apply(e,t||[])).next())}))},P=function(e,t){var n,a,r,o,i={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return o={next:l(0),throw:l(1),return:l(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function l(l){return function(s){return function(l){if(n)throw new TypeError("Generator is already executing.");for(;o&&(o=0,l[0]&&(i=0)),i;)try{if(n=1,a&&(r=2&l[0]?a.return:l[0]?a.throw||((r=a.return)&&r.call(a),0):a.next)&&!(r=r.call(a,l[1])).done)return r;switch(a=0,r&&(l=[2&l[0],r.value]),l[0]){case 0:case 1:r=l;break;case 4:return i.label++,{value:l[1],done:!1};case 5:i.label++,a=l[1],l=[0];continue;case 7:l=i.ops.pop(),i.trys.pop();continue;default:if(!(r=i.trys,(r=r.length>0&&r[r.length-1])||6!==l[0]&&2!==l[0])){i=0;continue}if(3===l[0]&&(!r||l[1]>r[0]&&l[1]<r[3])){i.label=l[1];break}if(6===l[0]&&i.label<r[1]){i.label=r[1],r=l;break}if(r&&i.label<r[2]){i.label=r[2],i.ops.push(l);break}r[2]&&i.ops.pop(),i.trys.pop();continue}l=t.call(e,i)}catch(e){l=[6,e],a=0}finally{n=r=0}if(5&l[0])throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}([l,s])}}},B=function(e,t){return O(void 0,void 0,void 0,(function(){var n;return P(this,(function(a){switch(a.label){case 0:return[4,d().get("/api/calendar-events",{params:{start:e,end:t}})];case 1:return n=a.sent(),[2,(0,s.d8)(_,n.data.events)]}}))}))},M=function(e,t){return O(void 0,void 0,void 0,(function(){var n;return P(this,(function(a){switch(a.label){case 0:return[4,d().get("/api/calendar-timetables",{params:{start:e,end:t}}).catch((function(e){return{data:{timetables:[]}}}))];case 1:return n=a.sent(),[2,(0,s.d8)(C,n.data.timetables)]}}))}))},R=function(e){return O(void 0,void 0,void 0,(function(){var t;return P(this,(function(n){switch(n.label){case 0:return[4,d().get("/api/user/".concat(e,"/calendar-tag"))];case 1:return t=n.sent(),[2,(0,s.d8)(E,t.data.data)]}}))}))},F=function(e){return O(void 0,void 0,void 0,(function(){var t;return P(this,(function(n){switch(n.label){case 0:return[4,d().post("/api/calendar-tag",e)];case 1:return t=n.sent(),[2,(0,s.d8)(E,t.data.data)]}}))}))},Y=(n(470189),n(454747),n(866473)),Z=function(e){var t=(0,o.iH)(""),n=(0,o.iH)(),a=(0,o.iH)(0);(0,o.YP)((function(){return e.calendar}),(function(e){t.value=e.view.title,a.value=e.getOption("firstDay")||0}));var r=(0,o.f3)("context",{});(0,o.bv)((function(){r.$on("date-change",(function(){t.value=e.calendar.view.title}))})),(0,o.YP)(t,(function(){n.value=e.calendar.view.currentStart}));return{title:t,date:n,dow:a,prev:function(){e.calendar.prev(),t.value=e.calendar.view.title,r.$emit("date-change")},next:function(){e.calendar.next(),t.value=e.calendar.view.title,r.$emit("date-change")},today:function(){e.calendar.today(),t.value=e.calendar.view.title,r.$emit("date-change")},goto:function(n){e.calendar.gotoDate(n),t.value=e.calendar.view.title,r.$emit("date-change")}}},N=(0,o.aZ)({components:{Icon:Y.Icon},props:{calendar:{type:Object,default:function(){return{}}},options:{type:Object,required:!0}},setup:function(e){var t=Z(e),n=t.title,a=t.date,r=t.dow,l=t.prev,s=t.next,c=(0,o.f3)("context"),u=(0,o.iH)("");c.$on("on-key-day-change",(function(e){u.value=i(e).format("YYYYMMDD")}));var d=(0,o.Fl)((function(){return function(e,t){void 0===t&&(t=0);for(var n=[],a=i(e).startOf("month").day()-t;a>0;a--){var r=i(e).startOf("month");n.push(r.subtract(a,"day"))}var o=42-n.length;for(a=0;a<o;a++)r=i(e).startOf("month"),n.push(r.add(a,"day"));var l=i(e).month();return n.map((function(e){var t=e.month()===l,n=e.format("YYYYMMDD");return{inMonth:t,isToday:n===i().format("YYYYMMDD"),value:e.date(),date:e.toDate(),formatStr:n}}))}(a.value,r.value)})),p=function(e,t,n){void 0===n&&(n=function(e){return!0});for(var a=i(e),r=i(t),o=Math.ceil(r.diff(a,"days",!0)),l=[],s=0;s<o;s++){var c=i(e).add(s,"days").startOf("day");n(c)&&l.push(c.format("YYYYMMDD"))}return l},f=(0,o.Fl)((function(){var t,n=new Set;return null===(t=e.options.events)||void 0===t||t.forEach((function(e){(e.startRecur&&e.endRecur?p(e.startRecur,e.endRecur,(function(t){return e.daysOfWeek.includes(t.day())})):p(e.start,e.end)).forEach((function(e){return n.add(e)}))})),n}));return{weeks:(0,o.Fl)((function(){var t;if(null===(t=e.calendar)||void 0===t?void 0:t.getCurrentData){var n=e.calendar.getCurrentData().dateEnv.locale.codes[0],a=Intl.DateTimeFormat(n,{weekday:/^zh/.test(n)?"narrow":"short"});return d.value.slice(0,7).map((function(e){var t=e.date;return a.format(t)}))}return[]})),dates:d,title:n,prev:l,next:s,eventDays:f,keyDay:u}}}),z=n(551900),L=(0,z.Z)(N,(function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"month-calendar"},[n("div",{staticClass:"month-calendar-header"},[n("div",{staticClass:"month-calendar-date"},[e._v(e._s(e.title))]),e._v(" "),n("div",[n("a",{staticClass:"month-calendar-btn",on:{click:e.prev}},[n("Icon",{attrs:{type:"ios-arrow-back"}})],1),e._v(" "),n("a",{staticClass:"month-calendar-btn",on:{click:e.next}},[n("Icon",{attrs:{type:"ios-arrow-forward"}})],1)])]),e._v(" "),n("div",{staticClass:"month-calendar-content"},[e._l(e.weeks,(function(t){return n("div",{key:t,staticClass:"month-calendar-cell month-calendar-week"},[n("div",{staticClass:"moth-calendar-cell-content"},[e._v(e._s(t))])])})),e._v(" "),e._l(e.dates,(function(t,a){return n("div",{key:a,staticClass:"month-calendar-cell month-calendar-day",class:{"month-calendar-day-today":t.isToday,"out-month":!t.inMonth,"has-event":e.eventDays.has(t.formatStr),"current-day":t.formatStr===e.keyDay},style:{gridColumn:t.date}},[n("div",{staticClass:"moth-calendar-cell-content"},[e._v(e._s(t.value))])])}))],2)])}),[],!1,null,"753687b9",null).exports,H=(n(140561),n(117403)),j=n(202669),A=function(){function e(e,t){void 0===t&&(t={selected:!1}),this.color=e,this.states=t}return Object.defineProperty(e.prototype,"selected",{get:function(){return this.states.selected},enumerable:!1,configurable:!0}),e.prototype.select=function(){this.states.selected=!0},e.prototype.unselect=function(){this.states.selected=!1},e.prototype.toggleSelect=function(){this.states.selected=!this.states.selected},e}(),U=(0,o.aZ)({props:{colors:{type:Array,default:function(){return[]}},value:{type:String,required:!0}},setup:function(e,t){var n,a=(0,o.iH)([]);(0,o.m0)((function(){a.value=e.colors.map((function(t){return new A(t,{selected:t===e.value})}))}));var r=null===(n=(0,o.FN)())||void 0===n?void 0:n.proxy,i=function(e){a.value=a.value.map((function(e){return e.unselect(),e})),e.toggleSelect();var n=e.selected?e.color:"";t.emit("input",n),r&&"FormItem"===r.$parent.$options.name&&r.$parent.$emit("on-form-change",n)};return i(a.value[0]),{colorModels:a,pick:i}}}),q=(0,z.Z)(U,(function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"calendar-color-picker"},e._l(e.colorModels,(function(t){return n("span",{key:t.color,staticClass:"calendar-color",class:{selected:t.selected},style:{backgroundColor:t.color},on:{click:function(n){return e.pick(t)}}})})),0)}),[],!1,null,null,null).exports,G=function(e,t,n,a){return new(n||(n=Promise))((function(r,o){function i(e){try{s(a.next(e))}catch(e){o(e)}}function l(e){try{s(a.throw(e))}catch(e){o(e)}}function s(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,l)}s((a=a.apply(e,t||[])).next())}))},V=function(e,t){var n,a,r,o,i={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return o={next:l(0),throw:l(1),return:l(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function l(l){return function(s){return function(l){if(n)throw new TypeError("Generator is already executing.");for(;o&&(o=0,l[0]&&(i=0)),i;)try{if(n=1,a&&(r=2&l[0]?a.return:l[0]?a.throw||((r=a.return)&&r.call(a),0):a.next)&&!(r=r.call(a,l[1])).done)return r;switch(a=0,r&&(l=[2&l[0],r.value]),l[0]){case 0:case 1:r=l;break;case 4:return i.label++,{value:l[1],done:!1};case 5:i.label++,a=l[1],l=[0];continue;case 7:l=i.ops.pop(),i.trys.pop();continue;default:if(!(r=i.trys,(r=r.length>0&&r[r.length-1])||6!==l[0]&&2!==l[0])){i=0;continue}if(3===l[0]&&(!r||l[1]>r[0]&&l[1]<r[3])){i.label=l[1];break}if(6===l[0]&&i.label<r[1]){i.label=r[1],r=l;break}if(r&&i.label<r[2]){i.label=r[2],i.ops.push(l);break}r[2]&&i.ops.pop(),i.trys.pop();continue}l=t.call(e,i)}catch(e){l=[6,e],a=0}finally{n=r=0}if(5&l[0])throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}([l,s])}}},W=(0,o.aZ)({components:{Modal:Y.Modal,Form:Y.Form,FormItem:Y.FormItem,Input:Y.Input,ColorPicker:q,Button:Y.Button},props:{value:Boolean,tag:Object,title:String},setup:function(e,t){var n=this,a=(0,o.iH)({name:"",color:""}),r=(0,o.iH)(),i={name:[{required:!0,message:H.default.t("fieldRequired"),trigger:"change"}],color:[{required:!0,message:H.default.t("fieldRequired"),trigger:"change"}]},l=(0,o.iH)();(0,o.YP)((function(){return e.tag}),(function(){var t,n,r,o;a.value.name=null!==(n=null===(t=e.tag)||void 0===t?void 0:t.name)&&void 0!==n?n:"",a.value.color=null!==(o=null===(r=e.tag)||void 0===r?void 0:r.color)&&void 0!==o?o:""}));var c=function(){t.emit("input",!1)};return{colors:g,formData:a,colorPickerRef:l,rules:i,visibleChange:function(e){e||r.value.resetFields(),t.emit("input",e)},pickColor:function(e){a.value.color=e},formRef:r,save:function(){return G(n,void 0,void 0,(function(){var n,o,i;return V(this,(function(l){switch(l.label){case 0:return[4,null===(o=r.value)||void 0===o?void 0:o.validate()];case 1:return l.sent()?(null===(i=e.tag)||void 0===i?void 0:i.id)?[4,(u=e.tag.id,p=a.value,O(void 0,void 0,void 0,(function(){var e;return P(this,(function(t){switch(t.label){case 0:return[4,d().put("/api/calendar-tag/".concat(u),p)];case 1:return e=t.sent(),[2,(0,s.d8)(E,e.data.data)]}}))})))]:[3,3]:[2];case 2:return n=l.sent(),t.emit("on-updated-tag",n),[3,5];case 3:return[4,F(a.value)];case 4:n=l.sent(),t.emit("on-added-tag",n),l.label=5;case 5:return c(),[2]}var u,p}))}))},cancel:c}}}),K=(0,z.Z)(W,(function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("Modal",{staticClass:"edit-tag-modal",attrs:{title:e.title,value:e.value},on:{"on-visible-change":e.visibleChange},scopedSlots:e._u([{key:"footer",fn:function(){return[n("Button",{attrs:{type:"primary"},on:{click:e.save}},[e._v(e._s(e.$t("save")))]),e._v(" "),n("Button",{on:{click:e.cancel}},[e._v(e._s(e.$t("cancel")))])]},proxy:!0}])},[n("Form",{ref:"formRef",attrs:{"label-width":120,rules:e.rules,model:e.formData}},[n("FormItem",{attrs:{label:e.$t("calendar.calendarTagName"),prop:"name"}},[n("Input",{attrs:{"show-word-limit":"",maxlength:"10",placeholder:e.$t("please_input")},model:{value:e.formData.name,callback:function(t){e.$set(e.formData,"name",t)},expression:"formData.name"}})],1),e._v(" "),n("FormItem",{attrs:{label:e.$t("calendar.calendarTagColor"),prop:"color"}},[n("ColorPicker",{ref:"colorPickerRef",attrs:{colors:e.colors},model:{value:e.formData.color,callback:function(t){e.$set(e.formData,"color",t)},expression:"formData.color"}})],1)],1)],1)}),[],!1,null,null,null).exports,J=(0,o.aZ)({components:{Icon:Y.Icon},props:{icon:String,size:{type:Number,default:14}}}),Q=(0,z.Z)(J,(function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("a",{staticClass:"month-calendar-btn",style:{"font-size":e.size+"px"}},[e._t("default",[n("Icon",{attrs:{type:e.icon}})])],2)}),[],!1,null,"317cf486",null).exports,X=n(391737),ee=n(383228),te=function(e,t,n,a){return new(n||(n=Promise))((function(r,o){function i(e){try{s(a.next(e))}catch(e){o(e)}}function l(e){try{s(a.throw(e))}catch(e){o(e)}}function s(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,l)}s((a=a.apply(e,t||[])).next())}))},ne=function(e,t){var n,a,r,o,i={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return o={next:l(0),throw:l(1),return:l(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function l(l){return function(s){return function(l){if(n)throw new TypeError("Generator is already executing.");for(;o&&(o=0,l[0]&&(i=0)),i;)try{if(n=1,a&&(r=2&l[0]?a.return:l[0]?a.throw||((r=a.return)&&r.call(a),0):a.next)&&!(r=r.call(a,l[1])).done)return r;switch(a=0,r&&(l=[2&l[0],r.value]),l[0]){case 0:case 1:r=l;break;case 4:return i.label++,{value:l[1],done:!1};case 5:i.label++,a=l[1],l=[0];continue;case 7:l=i.ops.pop(),i.trys.pop();continue;default:if(!(r=i.trys,(r=r.length>0&&r[r.length-1])||6!==l[0]&&2!==l[0])){i=0;continue}if(3===l[0]&&(!r||l[1]>r[0]&&l[1]<r[3])){i.label=l[1];break}if(6===l[0]&&i.label<r[1]){i.label=r[1],r=l;break}if(r&&i.label<r[2]){i.label=r[2],i.ops.push(l);break}r[2]&&i.ops.pop(),i.trys.pop();continue}l=t.call(e,i)}catch(e){l=[6,e],a=0}finally{n=r=0}if(5&l[0])throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}([l,s])}}},ae=function(e,t,n){if(n||2===arguments.length)for(var a,r=0,o=t.length;r<o;r++)!a&&r in t||(a||(a=Array.prototype.slice.call(t,0,r)),a[r]=t[r]);return e.concat(a||Array.prototype.slice.call(t))},re=null===(D=null===(T=window.globalData)||void 0===T?void 0:T.user)||void 0===D?void 0:D.id,oe=(0,o.aZ)({components:{Collapse:Y.Collapse,Panel:Y.Panel,Checkbox:Y.Checkbox,Modal:Y.Modal,Form:Y.Form,FormItem:Y.FormItem,Input:Y.Input,AddTagModel:K,IconButton:Q},setup:function(e,t){var n=this,a=(0,o.iH)([]),r=(0,o.iH)([E.fromObj({id:-1,color:"#FF9700",name:H.default.t("calendar.course")}),E.fromObj({id:-2,color:"#4892F6",name:H.default.t("calendar.event")})]),i=(0,o.Fl)((function(){return ae(ae([],a.value.filter((function(e){return e.checked})),!0),r.value.filter((function(e){return e.checked})),!0)})),l=(0,o.f3)("context");(0,o.YP)(i,(function(e){l.$emit("on-checked-tag-change",e)}));var s=(0,o.iH)({showing:!1,title:H.default.t("calendar.addCalendarTag")});(0,o.YP)((function(){return s.value.showing}),(function(e){e||(s.value.tag=void 0)})),(0,o.YP)(a,(function(e){var t=ee("[ng-controller=CalendarEventController]").get(0),n=(0,X.useAngularScope)(t);(null==n?void 0:n.ui)&&(n.ui.tags=e.filter((function(e){return e.editable}))),null==n||n.$apply()}));return(0,o.YP)((function(){return l.$props.isShowCalendar}),(function(e){return te(n,void 0,void 0,(function(){var t;return ne(this,(function(n){switch(n.label){case 0:return e?[4,R(re)]:[2];case 1:return t=n.sent(),(0,o.iH)(["Admin","Instructor"].includes(window.globalData.user.role)).value?a.value=t:a.value=t.filter((function(e){return e.editable})),[2]}}))}))})),{tags:a,fixedTags:r,checkedTag:i,editModal:s,addTag:function(e){e.check(),a.value.push(e),Y.Message.success(H.default.t("save_success"))},updateTag:function(e){var t=a.value.find((function(t){return t.id===e.id})),n=a.value.findIndex((function(t){return t.id===e.id}));if(t){var r=a.value.filter((function(t){return t.id!==e.id}));r.splice(n,0,e),a.value=r,Y.Message.success(H.default.t("save_success")),l.$emit("on-updated-tag",e)}},closeEditModal:function(){s.value.tag=void 0},openEditModal:function(e){e?(s.value.tag=e,s.value.title=H.default.t("calendar.editCalendarTag")):s.value.title=H.default.t("calendar.addCalendarTag"),s.value.showing=!0},delTag:function(e){return te(n,void 0,void 0,(function(){return ne(this,(function(t){switch(t.label){case 0:return[4,j.Z.open({type:"warning",title:H.default.t("calendar.deleteCalendarTag"),content:H.default.t("calendar.delTagTips")})];case 1:return t.sent()?[4,(n=e.id,O(void 0,void 0,void 0,(function(){return P(this,(function(e){switch(e.label){case 0:return[4,d().delete("/api/calendar-tag/".concat(n))];case 1:return[2,{message:e.sent().data.message}]}}))})))]:[3,3];case 2:t.sent(),Y.Message.success(H.default.t("delete_success")),a.value=a.value.filter((function(t){return t.id!==e.id})),l.$emit("on-deleted-tag",e),t.label=3;case 3:return[2]}var n}))}))}}}}),ie=(0,z.Z)(oe,(function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"calendar-type-list"},[n("Collapse",{attrs:{simple:"",value:["owner","participation"]}},[n("Panel",{attrs:{name:"owner","hide-arrow":""},scopedSlots:e._u([{key:"content",fn:function(){return e._l(e.tags,(function(t){return n("div",{key:t.id,staticClass:"panel-content-item"},[n("Checkbox",{staticClass:"panel-content-item-checkbox",style:{"--color":t.color},model:{value:t.checked,callback:function(n){e.$set(t,"checked",n)},expression:"t.checked"}},[n("span",[e._v(e._s(t.name))])]),e._v(" "),t.editable?n("span",{staticClass:"panel-content-item-operator"},[n("IconButton",{nativeOn:{click:function(n){return e.openEditModal(t)}}},[n("i",{staticClass:"font font-edit"})]),e._v(" "),n("IconButton",{nativeOn:{click:function(n){return e.delTag(t)}}},[n("i",{staticClass:"font font-delete"})])],1):e._e()],1)}))},proxy:!0}])},[n("span",{staticClass:"panel-header"},[n("span",[n("i",{staticClass:"font font-collapse-arrow"}),e._v(" "),n("span",{staticClass:"panel-header-content"},[e._v(e._s(e.$t("calendar.managing")))])]),e._v(" "),n("span",[n("IconButton",{nativeOn:{click:function(t){return t.stopPropagation(),e.openEditModal()}}},[n("i",{staticClass:"font font-add"})])],1)])]),e._v(" "),n("Panel",{attrs:{name:"participation","hide-arrow":""},scopedSlots:e._u([{key:"content",fn:function(){return e._l(e.fixedTags,(function(t){return n("div",{key:t.id,staticClass:"panel-content-item"},[n("Checkbox",{style:{"--color":t.color},model:{value:t.checked,callback:function(n){e.$set(t,"checked",n)},expression:"t.checked"}},[n("span",[e._v(e._s(t.name))])])],1)}))},proxy:!0}])},[n("span",{staticClass:"panel-header"},[n("span",[n("i",{staticClass:"font font-collapse-arrow"}),e._v(" "),n("span",{staticClass:"panel-header-content"},[e._v(e._s(e.$t("calendar.participating")))])])])])],1),e._v(" "),n("AddTagModel",{attrs:{title:e.editModal.title,tag:e.editModal.tag},on:{"on-added-tag":e.addTag,"on-updated-tag":e.updateTag},model:{value:e.editModal.showing,callback:function(t){e.$set(e.editModal,"showing",t)},expression:"editModal.showing"}})],1)}),[],!1,null,"46014ada",null).exports,le=(0,o.aZ)({components:{MonthCalendar:L,CalendarTypeList:ie},props:{calendar:{type:Object,default:function(){return{}}},options:{type:Object}}}),se=(0,z.Z)(le,(function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"side-wrapper"},[n("div",{staticClass:"calendar-side"},[n("MonthCalendar",{attrs:{calendar:e.calendar,options:e.options}})],1),e._v(" "),n("CalendarTypeList")],1)}),[],!1,null,"3ed91fb9",null).exports,ce=(0,o.aZ)({props:["size"],components:{Button:Q}}),ue=(0,z.Z)(ce,(function(){var e=this,t=e.$createElement;return(e._self._c||t)("Button",{attrs:{icon:"ios-arrow-back",size:e.size}})}),[],!1,null,null,null).exports,de=(0,o.aZ)({props:["size"],components:{Button:Q}}),pe=(0,z.Z)(de,(function(){var e=this,t=e.$createElement;return(e._self._c||t)("Button",{attrs:{size:e.size,icon:"ios-arrow-forward"}})}),[],!1,null,null,null).exports,fe=n(311610),ve=(0,o.aZ)({components:{SvgIcon:fe.Z,ButtonGroup:Y.ButtonGroup,Button:Y.Button,Dropdown:Y.Dropdown,DropdownMenu:Y.DropdownMenu,DropdownItem:Y.DropdownItem,Icon:Y.Icon},setup:function(e,t){var n=(0,o.iH)([]),a=(0,o.Fl)((function(){return n.value.length})),r=(0,o.f3)("context"),i=(0,o.iH)();(0,o.YP)(i,(function(){i.value&&r.$emit("on-key-day-change",i.value)}));return(0,o.bv)((function(){O(void 0,void 0,void 0,(function(){var e;return P(this,(function(t){switch(t.label){case 0:return[4,d().get("/api/calendar-key-events")];case 1:return e=t.sent(),[2,(0,s.d8)($,e.data.critical_times)]}}))})).then((function(e){n.value=e})),i.value=new Date})),{hasMore:a,dates:n,handleClick:function(e){var n;n="string"==typeof e?new Date(e):e,t.emit("on-goto-date",n),i.value=n}}}}),me=(0,z.Z)(ve,(function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("ButtonGroup",{staticClass:"calendar-today-btn"},[n("Button",{staticClass:"add-btn",on:{click:function(t){e.handleClick(new Date)}}},[e._v(e._s(e.$t("today")))]),e._v(" "),e.hasMore?n("Dropdown",{on:{"on-click":e.handleClick},scopedSlots:e._u([{key:"list",fn:function(){return[n("DropdownMenu",e._l(e.dates,(function(t,a){return n("DropdownItem",{key:a,attrs:{name:t.value}},[e._v("\n          "+e._s(t.name)+"\n        ")])})),1)]},proxy:!0}],null,!1,1236802870)},[n("Button",{staticClass:"dropdown-btn"},[n("Icon",{attrs:{type:"ios-arrow-down"}})],1)],1):e._e()],1)}),[],!1,null,"57f0b54b",null).exports,he=n(383228),ye=(0,o.aZ)({components:{PrevBtn:ue,NextBtn:pe,ButtonGroup:Y.ButtonGroup,Button:Y.Button,Icon:Y.Icon,IconButton:Q,Dropdown:Y.Dropdown,DropdownItem:Y.DropdownItem,TodayBtn:me},props:{calendar:{type:Object,default:function(){return{}}}},setup:function(e){var t=(0,o.iH)(),n=Z(e),a=n.prev,r=n.next,i=n.title,l=n.goto,s=(0,o.iH)(["Admin","Instructor"].includes(window.globalData.user.role))&&window.featureToggles.calendar_timetable;return{eleRef:t,title:i,close:function(){var e=(0,X.useAngularScope)(t.value);e.toggleCalendar(),e.$apply()},prev:a,next:r,add:function(e){var t=(0,X.useAngularScope)(he("[ng-controller=CalendarController]").get(0));"event"===e?t.$broadcast("bindEventForNew"):t.$broadcast("bindTimetableForNew")},goto:l,canAddTimetable:s}}}),ge=(0,z.Z)(ye,(function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{ref:"eleRef",staticClass:"calendar-toolbar-wrapper"},[n("div",{staticClass:"calendar-toolbar-left"},[n("div",{staticClass:"calendar-toolbar-title-wrapper"},[n("PrevBtn",{attrs:{size:18},nativeOn:{click:function(t){return e.prev(t)}}}),e._v(" "),n("span",{staticClass:"calendar-toolbar-date"},[e._v(e._s(e.title))]),e._v(" "),n("NextBtn",{attrs:{size:18},nativeOn:{click:function(t){return e.next(t)}}})],1),e._v(" "),n("TodayBtn",{on:{"on-goto-date":e.goto}})],1),e._v(" "),n("div",{staticClass:"calendar-toolbar-right"},[n("ButtonGroup",{staticClass:"calendar-toolbar-item"}),e._v(" "),n("Dropdown",{attrs:{transfer:""},on:{"on-click":e.add},scopedSlots:e._u([{key:"list",fn:function(){return[e.canAddTimetable?n("DropdownItem",{attrs:{name:"timetable"}},[e._v(e._s(e.$t("calendar.createCourse")))]):e._e(),e._v(" "),n("DropdownItem",{attrs:{name:"event"}},[e._v(e._s(e.$t("calendar.createEvent")))])]},proxy:!0}])},[n("Button",{staticClass:"calendar-toolbar-item"},[n("Icon",{attrs:{type:"md-add"}}),e._v("\n        "+e._s(e.$t("calendar.create"))+"\n      ")],1)],1),e._v(" "),n("IconButton",{staticClass:"calendar-toolbar-item",attrs:{size:18,icon:"md-close"},nativeOn:{click:function(t){return e.close(t)}}})],1)])}),[],!1,null,"52c1f545",null).exports,be=n(598952),we=n(91166),_e=n(371606),Ce=n(383228),xe=function(e){return function(t){var n=t.date.getDate(),a=i(t.date).startOf("month").format("YYYY-MM-DD")===i(t.date).format("YYYY-MM-DD");if(/^zh/.test(e)){var r="";a&&(r="".concat(i(t.date).month()+1,"月"),n="".concat(n,"日"));var o=_e.Lunar.fromDate(t.date),l=1===o.getDay()?"".concat(o.getMonthInChinese(),"月"):o.getJieQi()||o.getDayInChinese();return{html:'<span>\n              <span class="daygrid-day-top" '.concat(a?"style='padding: 0 5px; border-radius: 20px; width: auto;'":"",">\n                ").concat(r).concat(n,"\n              </span>\n              ").concat("zh-CN"===e?"<span>".concat(l,"</span>"):"","\n            </span>")}}return{html:'<span class="daygrid-day-top">'.concat(n,"</span>")}}},ke=function(e){var t,n,a=e.event.extendedProps,r=a.type,o=a.data,l=(0,s.ZE)(o);l.type=r;var c=(0,X.useAngularScope)(),u=(0,X.useAngularScope)(Ce("[ng-controller=CalendarController]").get(0)),d=null!==(t=e.event.end)&&void 0!==t?t:i(e.event.start).add(o.duration(),"minute").toDate();c.currentCalendar={allDay:o.allDay,backgroundColor:y(o.color,.1),data:l,editable:o.editable,id:o.id,type:r,title:e.event.title,uploads:o.uploads,start:e.event.start,end:d,timeRange:u.formatEventTimeRange({start:e.event.start,end:d}),alertTime:null===(n=u.ui.alerts.find((function(e){return e.id===l.alert_id})))||void 0===n?void 0:n.text,isOwner:o.isOwner},c.uploads=c.currentCalendar.uploads,u.$apply(),setTimeout((function(){(null!=c.currentCalendar?c.currentCalendar.start:void 0)===e.event.start&&Ce(e.el).attr("data-target")||(Ce(e.el).webuiPopover("destroy").webuiPopover({multi:!1,dismissible:!0,width:400,padding:!1,style:"calendar",arrow:!1,trigger:"click",content:function(){return Ce("#calendar-detail-popup").clone(!0,!0)}}).webuiPopover("show"),Ce(e.el).off("click"))}))},Se=function(e){var t=document.createElement("div");return t.classList.add("fc-daygrid-event-dot"),t.style.borderColor=e.dotColor||e.borderColor||e.backgroundColor,t.style.setProperty("--dot-color",t.style.borderColor),t},Te=function(e){var t=e.event,n=e.timeText,a=e.textColor,r="";return t.allDay?r=H.default.t("calendar.allDay"):!t.extendedProps.data.multiDay&&i(t.extendedProps.data.endTime).isSame(t.extendedProps.data.startTime,"day")||(r=H.default.t("calendar.crossDay")),r?function(e,t){var n=e.event,a=e.textColor,r=document.createElement("div"),o=document.createElement("div"),i=document.createElement("div"),l=document.createElement("div"),s=document.createElement("span"),c=document.createElement("span"),u=Se(n);return c.innerText=n.title,c.style.overflow="hidden",c.style.textOverflow="ellipsis",s.style.marginRight="5px",s.innerText=t,l.classList.add("fc-event-title","fc-sticky"),l.style.display="flex",l.style.alignItems="center",l.append(u,s,c),i.classList.add("fc-event-title-container"),i.append(l),o.classList.add("fc-event-main-frame"),o.append(i),r.classList.add("fc-event-main"),r.style.color=a,r.append(o),{domNodes:[r]}}({event:t,textColor:a},r):function(e){var t=e.event,n=e.timeText,a=Se(t),r=document.createElement("div"),o=document.createElement("div");return r.classList.add("fc-event-time"),r.innerHTML=n,o.classList.add("fc-event-title"),o.innerHTML=t.title,{domNodes:[a,r,o]}}({event:t,timeText:n})},De=n(383228),Ee=function(){return(Ee=Object.assign||function(e){for(var t,n=1,a=arguments.length;n<a;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)},$e=function(e,t,n,a){return new(n||(n=Promise))((function(r,o){function i(e){try{s(a.next(e))}catch(e){o(e)}}function l(e){try{s(a.throw(e))}catch(e){o(e)}}function s(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,l)}s((a=a.apply(e,t||[])).next())}))},Ie=function(e,t){var n,a,r,o,i={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return o={next:l(0),throw:l(1),return:l(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function l(l){return function(s){return function(l){if(n)throw new TypeError("Generator is already executing.");for(;o&&(o=0,l[0]&&(i=0)),i;)try{if(n=1,a&&(r=2&l[0]?a.return:l[0]?a.throw||((r=a.return)&&r.call(a),0):a.next)&&!(r=r.call(a,l[1])).done)return r;switch(a=0,r&&(l=[2&l[0],r.value]),l[0]){case 0:case 1:r=l;break;case 4:return i.label++,{value:l[1],done:!1};case 5:i.label++,a=l[1],l=[0];continue;case 7:l=i.ops.pop(),i.trys.pop();continue;default:if(!(r=i.trys,(r=r.length>0&&r[r.length-1])||6!==l[0]&&2!==l[0])){i=0;continue}if(3===l[0]&&(!r||l[1]>r[0]&&l[1]<r[3])){i.label=l[1];break}if(6===l[0]&&i.label<r[1]){i.label=r[1],r=l;break}if(r&&i.label<r[2]){i.label=r[2],i.ops.push(l);break}r[2]&&i.ops.pop(),i.trys.pop();continue}l=t.call(e,i)}catch(e){l=[6,e],a=0}finally{n=r=0}if(5&l[0])throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}([l,s])}}},Oe=function(e,t,n){if(n||2===arguments.length)for(var a,r=0,o=t.length;r<o;r++)!a&&r in t||(a||(a=Array.prototype.slice.call(t,0,r)),a[r]=t[r]);return e.concat(a||Array.prototype.slice.call(t))},Pe=(0,o.aZ)({i18n:H.default,props:{isShowCalendar:{type:Boolean},firstDay:{type:Number,default:1},showTeachingWeek:{type:Boolean,default:!1}},components:{Sidebar:se,Calendar:l.Z,Toolbar:ge},provide:function(){return{context:this}},setup:function(e){var t,n,a=this,r=(0,o.iH)(),l=(0,o.Fl)((function(){var e,t;return null!==(t=null===(e=r.value)||void 0===e?void 0:e.getApi())&&void 0!==t?t:{}})),u=(0,o.iH)(new Date),f=(0,o.iH)([]),v=(0,o.iH)([]),m=null!==(t=De("html").attr("lang"))&&void 0!==t?t:"en-US",h=function(e,t,n,a){void 0===n&&(n=0);var r=function(){var t;if(e.value){var n=(null===(t=e.value.$el.querySelector("tbody .fc-scroller-harness"))||void 0===t?void 0:t.getBoundingClientRect()).height/6;Ce(".fc-daygrid-body tr").height(n)}},l=function(e){document.querySelectorAll(".fc-day[data-date]").forEach((function(e){return e.classList.remove("current-day")}));var t=i(e).format("YYYY-MM-DD");document.querySelectorAll('.fc-day[data-date="'.concat(t,'"]')).forEach((function(e){e.classList.add("current-day")}))},s=(0,o.iH)({extraColumns:{headers:[],data:[]},plugins:[be.Z,we.Z],eventOrder:"-duration,allDay,start,title",initialView:"dayGridMonth",headerToolbar:!1,locale:t,height:"100%",events:[],dayMaxEventRows:3,eventTimeFormat:{hour:"2-digit",minute:"2-digit"},firstDay:n,eventTextColor:"#525566",eventClick:ke,eventContent:Te,datesSet:function(e){r(),(null==a?void 0:a.value)&&l(a.value)},views:{dayGridMonth:{dayCellContent:xe(t),moreLinkText:function(e){return H.default.t("calendar.more",[e])}}},windowResize:function(){r()}});return a&&(0,o.YP)(a,(function(e){l(e)})),{calendarOptions:s,resize:r}}(r,m,e.firstDay,u),g=h.calendarOptions,b=h.resize;(0,o.YP)(r,(function(){b()}));var w=null===(n=(0,o.FN)())||void 0===n?void 0:n.proxy,x=function(e){if(e){var t=e.filter((function(e){return e.id>0})),n=t.map((function(e){return e.id})),a=e.filter((function(e){return e.id<0})).map((function(e){return e.color})),r=f.value,o=r.filter((function(e){var a,r=e.extendedProps,o=r.data;return"timetable"===r.type?o.isOwner&&t.some((function(e){return e.isTimetable})):o.isOwner&&(n.includes(null===(a=o.tag)||void 0===a?void 0:a.id)||o.legacyColor)})),i=r.filter((function(e){var t=e.extendedProps.data;return!t.isOwner&&a.includes(t.color)}));g.value.events=Oe(Oe([],o,!0),i,!0)}else g.value.events=f.value};(0,o.YP)(f,(function(){x(v.value)}));var T=function(e){return e.map((function(e){return"-"===e.name&&"-"===e.academicYearName&&"-"===e.semesterName?"<div class='extra-column-header'>".concat(e.name,"</div>"):"<div class='extra-column-header'>".concat(e.name,"</div><div class='extra-column-body'>").concat(e.academicYearName,"(").concat(e.semesterName,")</div>")}))},D=function(){return $e(a,void 0,void 0,(function(){var t,n,a,r,o,c,u;return Ie(this,(function(v){switch(v.label){case 0:return t=i(l.value.view.activeStart).format("YYYY-MM-DD"),n=i(l.value.view.activeEnd).subtract(1,"day").format("YYYY-MM-DD"),e.showTeachingWeek&&function(e,t){return O(void 0,void 0,void 0,(function(){var n;return P(this,(function(a){switch(a.label){case 0:return[4,d().get("/api/calendar-teaching-weeks",{params:{start:e,end:t}})];case 1:return n=a.sent(),[2,(0,s.d8)(I,(0,p.camelizeKeys)(n.data.items))]}}))}))}(t,n).then((function(e){g.value.extraColumns={headers:[H.default.t("calendar.teachingWeek")],data:[T(e)]}})),[4,Promise.all([B(t,n),M(t,n)])];case 1:return a=v.sent(),r=a[0],o=a[1],c=r.map((function(e){return k.fromEvent(e)})),u=o.map((function(e){return S.fromTimetable(e)})),f.value=Oe(Oe([],c,!0),u,!0),[2]}}))}))};return w&&(w.$on("on-checked-tag-change",(function(e){v.value=e,x(e)})),w.$on("on-updated-tag",(function(e){f.value=f.value.map((function(t){var n;return(null===(n=t.extendedProps.data.tag)||void 0===n?void 0:n.id)===e.id?(Object.assign(t.extendedProps.data.tag,e),Ee(Ee({},t),{backgroundColor:y(e.color,.4),borderColor:y(e.color,.4),dotColor:e.color})):t}))})),w.$on("on-key-day-change",(function(e){u.value=e})),w.$on("date-change",(function(){D()}))),(0,c.ORN)(window,"add-event-to-calendar",(function(e){var t=e.detail,n=t.type,a=t.data;if(a){var r=null;if("event"===n){var o=(0,s.d8)(_,a);r=k.fromEvent(o)}else if("timetable"===n){o=(0,s.d8)(C,a);r=S.fromTimetable(o)}r&&f.value.push(r)}})),(0,c.ORN)(window,"update-event-in-calendar",(function(){return $e(a,void 0,void 0,(function(){return Ie(this,(function(e){switch(e.label){case 0:return[4,D()];case 1:return e.sent(),[2]}}))}))})),(0,c.ORN)(window,"delete-event-in-calendar",(function(){return $e(a,void 0,void 0,(function(){return Ie(this,(function(e){switch(e.label){case 0:return[4,D()];case 1:return e.sent(),[2]}}))}))})),(0,o.YP)((function(){return e.isShowCalendar}),(function(){return $e(a,void 0,void 0,(function(){return Ie(this,(function(e){switch(e.label){case 0:return[4,D()];case 1:return e.sent(),[2]}}))}))})),{calendarRef:r,calendar:l,calendarOptions:g,fetchData:D}}}),Be=(0,z.Z)(Pe,(function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"calendar-wrapper"},[n("Sidebar",{attrs:{calendar:e.calendar,options:e.calendarOptions}}),e._v(" "),n("div",{staticStyle:{"flex-grow":"1"}},[n("Toolbar",{attrs:{calendar:e.calendar}}),e._v(" "),n("div",{staticClass:"calendar-content"},[n("Calendar",{ref:"calendarRef",staticClass:"calendar",attrs:{options:e.calendarOptions}})],1)],1)],1)}),[],!1,null,"8c152be8",null).exports},629477:function(e,t,n){"use strict";n.d(t,{Z:function(){return v}});n(141817),n(66992),n(788674),n(333948);var a=n(925706),r=(n(319601),n(454747),n(48496)),o=n(117403),i=function(){return(i=Object.assign||function(e){for(var t,n=1,a=arguments.length;n<a;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)},l=(0,a.aZ)({name:"ValidateResult",props:{result:{type:Object,required:!0},full:{type:Boolean,default:!0}},setup:function(e){var t={homework:"homework_score",exam:"exam_score",chapterExam:"chapter_exam",offlineScore:"offline_score",scorePercentage:"score_percentage"},n=(0,a.iH)(t.homework),l=(0,a.Fl)((function(){var t=e.full?400:600;return document.body.offsetHeight-t})),s=(0,a.Fl)((function(){var e=[{title:o.default.t("tabIndex"),key:"index"},{title:o.default.t("chaoxingScore.studentName"),key:"userName"},{title:o.default.t("chaoxingScore.studentNo"),key:"userNo"},{title:o.default.t("chaoxingScore.itemName"),key:"name"},{title:o.default.t("score"),key:"score"},{title:o.default.t("chaoxingScore.errorReason"),key:"error",className:"error-reason-column",width:150}];return n.value===t.offlineScore?e.filter((function(e){return"name"!==e.key})):e})),c=(0,a.Fl)((function(){return r._.countBy(e.result.validateRecords,"recordType")})),u=(0,a.Fl)((function(){var t=e.result.validateRecords.filter((function(e){return e.recordType===n.value})),a=[],r=1;return t.forEach((function(e){if(e.records&&e.records.length){var t=0;e.records.forEach((function(n){var o;a.push({index:r,userNo:e.userNo,userName:e.userName,error:n.error,name:n.name,score:n.score,rowspan:0===t?null===(o=e.records)||void 0===o?void 0:o.length:0,colspan:1}),t++}))}else a.push(i(i({},e),{index:r,rowspan:1,colspan:1}));r++})),a}));return{currentTab:n,columns:s,data:u,tableHeight:l,tabs:t,handleSpan:function(e){var t=e.row,n=e.columnIndex;return 0===n||1===n||2===n?[t.rowspan,t.colspan]:[1,1]},countByRecordType:c}}}),s=n(551900),c=(0,s.Z)(l,(function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"validate-result-wrapper"},[n("div",{staticClass:"overview-wrapper"},[n("i",{staticClass:"font font-info"}),e._v(" "),n("span",[e._t("default")],2)]),e._v(" "),n("div",{staticClass:"result-content-wrapper"},[n("div",{staticClass:"tabs-wrapper"},e._l(e.tabs,(function(t,a){return n("div",{key:a,staticClass:"tab",class:{active:e.currentTab===t},on:{click:function(n){e.currentTab=t}}},[e._v("\n        "+e._s(e.$t("chaoxingScore."+a))+" ("+e._s(e.countByRecordType[t]||0)+")\n      ")])})),0),e._v(" "),n("Table",{staticClass:"table-wrapper",attrs:{border:"",columns:e.columns,data:e.data,"max-height":e.tableHeight,"span-method":e.handleSpan}})],1)])}),[],!1,null,"7f14de0c",null).exports,u=n(726258),d=function(e,t,n,a){return new(n||(n=Promise))((function(r,o){function i(e){try{s(a.next(e))}catch(e){o(e)}}function l(e){try{s(a.throw(e))}catch(e){o(e)}}function s(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,l)}s((a=a.apply(e,t||[])).next())}))},p=function(e,t){var n,a,r,o,i={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return o={next:l(0),throw:l(1),return:l(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function l(l){return function(s){return function(l){if(n)throw new TypeError("Generator is already executing.");for(;o&&(o=0,l[0]&&(i=0)),i;)try{if(n=1,a&&(r=2&l[0]?a.return:l[0]?a.throw||((r=a.return)&&r.call(a),0):a.next)&&!(r=r.call(a,l[1])).done)return r;switch(a=0,r&&(l=[2&l[0],r.value]),l[0]){case 0:case 1:r=l;break;case 4:return i.label++,{value:l[1],done:!1};case 5:i.label++,a=l[1],l=[0];continue;case 7:l=i.ops.pop(),i.trys.pop();continue;default:if(!(r=i.trys,(r=r.length>0&&r[r.length-1])||6!==l[0]&&2!==l[0])){i=0;continue}if(3===l[0]&&(!r||l[1]>r[0]&&l[1]<r[3])){i.label=l[1];break}if(6===l[0]&&i.label<r[1]){i.label=r[1],r=l;break}if(r&&i.label<r[2]){i.label=r[2],i.ops.push(l);break}r[2]&&i.ops.pop(),i.trys.pop();continue}l=t.call(e,i)}catch(e){l=[6,e],a=0}finally{n=r=0}if(5&l[0])throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}([l,s])}}},f=(0,a.aZ)({name:"ImportChaoxingScoreModal",components:{ValidateResult:c},setup:function(){var e,t,n=this,i=(0,a.iH)(!1),l=(0,a.iH)(1),s=(0,a.iH)(null),c=(0,a.iH)(!1),f=(0,a.iH)(!1),v=(null===(t=null===(e=window.globalData)||void 0===e?void 0:e.course)||void 0===t?void 0:t.id)||0;(0,a.wF)((function(){window.addEventListener("chaoxing-score-import:open",(function(){i.value=!0}))}));var m=(0,a.iH)(!1),h=(0,a.iH)(null),y=(0,a.iH)({accessKey:"",validateRecords:[],correctCount:0}),g=(0,a.Fl)((function(){return!!(1===l.value&&!h.value||2===l.value&&y.value.validateRecords.length&&!c.value)}));return{show:i,step:l,selectFileHandler:function(e){var t;if((null===(t=e.target.files)||void 0===t?void 0:t.length)&&1===e.target.files.length){h.value=e.target.files[0];var n=s.value;n&&(n.value="")}},mockFileSelect:function(){var e=s.value;null==e||e.click()},fileSelectRef:s,dropFileHandler:function(e){var t;e.preventDefault();var n=e.dataTransfer;if((null===(t=n.files)||void 0===t?void 0:t.length)&&1===n.files.length){var a=n.files[0];a.size<=5242880&&"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"===a.type&&(h.value=a)}},allowDrop:function(e){e.preventDefault()},upload:h,toNextStep:function(){return d(n,void 0,void 0,(function(){return p(this,(function(e){switch(e.label){case 0:if(1!==l.value)return[3,5];m.value=!0,e.label=1;case 1:return e.trys.push([1,3,,4]),[4,d(n,void 0,void 0,(function(){var e;return p(this,(function(t){switch(t.label){case 0:return e=y,[4,(0,u.xN)(h.value,"chaoxing_score",v)];case 1:return e.value=t.sent(),[2]}}))}))];case 2:return e.sent(),m.value=!1,[3,4];case 3:return 409===e.sent().response.status?r.Toast.error(o.default.t("chaoxingScore.duplicateActivity")):r.Toast.error(o.default.t("chaoxingScore.wrongFormat")),m.value=!1,[2];case 4:return[3,11];case 5:if(2!==l.value)return[3,10];m.value=!0,e.label=6;case 6:return e.trys.push([6,8,,9]),[4,(0,u.j1)(y.value.accessKey,v)];case 7:return e.sent(),f.value=!0,m.value=!1,[3,9];case 8:return e.sent(),r.Toast.error(o.default.t("importFailed")),m.value=!1,[2];case 9:return[3,11];case 10:3===l.value&&(i.value=!1),e.label=11;case 11:return l.value++,[2]}}))}))},reUploadFile:function(){h.value=null,l.value=1},validateSummary:y,onLoading:m,onVisibleChange:function(e){e||(l.value=1,h.value=null,f.value&&window.location.reload())},onlyImportCorrect:c,btnDisabled:g}}}),v=(0,s.Z)(f,(function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("Modal",{attrs:{title:e.$t("chaoxingScore.title"),width:900,"class-name":"vertical-center-modal"},on:{"on-visible-change":e.onVisibleChange},scopedSlots:e._u([{key:"footer",fn:function(){return[n("Button",{attrs:{type:"primary",disabled:e.btnDisabled,loading:e.onLoading},on:{click:e.toNextStep}},[1==e.step?n("span",[e._v(e._s(e.$t("chaoxingScore.check")))]):e._e(),e._v(" "),2==e.step?n("span",[e._v(e._s(e.$t("chaoxingScore.import")))]):e._e(),e._v(" "),3==e.step?n("span",[e._v(e._s(e.$t("chaoxingScore.finish")))]):e._e()]),e._v(" "),2==e.step?n("Button",{staticClass:"re-upload-btn",attrs:{type:"primary"},on:{click:e.reUploadFile}},[e._v("\n      "+e._s(e.$t("chaoxingScore.reUpload"))+"\n    ")]):e._e(),e._v(" "),2==e.step&&e.validateSummary.validateRecords.length?n("div",{staticClass:"allow-error-check-wrapper"},[n("Checkbox",{model:{value:e.onlyImportCorrect,callback:function(t){e.onlyImportCorrect=t},expression:"onlyImportCorrect"}},[e._v(e._s(e.$t("chaoxingScore.onlyImportCorrect")))])],1):e._e()]},proxy:!0}]),model:{value:e.show,callback:function(t){e.show=t},expression:"show"}},[n("div",{staticClass:"step-progress-wrapper"},[n("ol",{staticClass:"wizards text-center"},[n("li",{staticClass:"first wizard"},[e._v(e._s(e.$t("chaoxingScore.selectFile")))]),e._v(" "),n("li",{staticClass:"secondary wizard"},[e._v(e._s(e.$t("chaoxingScore.check")))]),e._v(" "),n("li",{staticClass:"third wizard"},[e._v(e._s(e.$t("chaoxingScore.doImport")))]),e._v(" "),n("div",{staticClass:"progress round"},[n("span",{staticClass:"meter",style:{width:e.step/3*100+"%"}})])])]),e._v(" "),n("div",{staticClass:"step-content-wrapper"},[n("div",{directives:[{name:"show",rawName:"v-show",value:1==e.step,expression:"step == 1"}],staticClass:"file-uploading-step"},[n("div",{staticClass:"upload-tip"},[n("div",{staticClass:"h-header"},[e._v(e._s(e.$t("chaoxingScore.tips")))]),e._v(" "),n("div",[e._v(e._s(e.$t("chaoxingScore.tips1")))]),e._v(" "),n("div",[e._v(e._s(e.$t("chaoxingScore.tips2")))]),e._v(" "),n("div",[e._v(e._s(e.$t("chaoxingScore.tips3")))])]),e._v(" "),n("div",{staticClass:"file-content-wrapper"},[n("input",{ref:"fileSelectRef",staticStyle:{display:"none"},attrs:{type:"file",accept:".xlsx"},on:{change:e.selectFileHandler}}),e._v(" "),n("div",{staticClass:"upload-area",on:{click:e.mockFileSelect,drop:e.dropFileHandler,dragover:e.allowDrop}},[n("div",{staticClass:"upload-area-container"},[n("div",{staticClass:"font font-import-upload"}),e._v(" "),n("div",{staticClass:"upload-tip-text"},[n("div",[e._v(e._s(e.$t("chaoxingScore.file.tips1")))]),e._v(" "),n("div",[e._v(e._s(e.$t("chaoxingScore.file.tips2")))]),e._v(" "),n("div",[e._v(e._s(e.$t("chaoxingScore.file.tips3")))])])])])]),e._v(" "),e.upload?n("div",{staticClass:"uploads-wrapper"},[n("div",{staticClass:"file-info-wrapper attachment-wrapper"},[n("div",{staticClass:"file-info-container attachment"},[n("span",{staticClass:"file-name"},[e._v(e._s(e.upload.name))]),e._v(" "),n("span",{staticClass:"separator"},[e._v("|")]),e._v(" "),n("span",{staticClass:"file-size"},[e._v(e._s(e._f("humanizeBytes")(e.upload.size)))])]),e._v(" "),n("div",{staticClass:"delete",on:{click:function(t){e.upload=null}}},[n("i",{staticClass:"icon icon-uploaded-delete"})])])]):e._e()]),e._v(" "),n("div",{directives:[{name:"show",rawName:"v-show",value:2==e.step,expression:"step == 2"}],staticClass:"data-validate-step"},[e.validateSummary.validateRecords.length?n("ValidateResult",{attrs:{result:e.validateSummary}},[e._v("\n        "+e._s(e.$t("chaoxingScore.correctCountTip",[e.validateSummary.correctCount]))+"\n      ")]):n("div",{staticClass:"check-pass-wrapper"},[n("i",{staticClass:"icon icon-no-data-error"}),e._v(" "),n("span",{staticClass:"text"},[e._v(e._s(e.$t("chaoxingScore.allCorrectTip",[e.validateSummary.correctCount])))])])],1),e._v(" "),n("div",{directives:[{name:"show",rawName:"v-show",value:3==e.step,expression:"step == 3"}],staticClass:"data-import-result-step"},[n("div",{staticClass:"import-result-wrapper",class:{full:0===e.validateSummary.validateRecords.length}},[n("i",{staticClass:"font font-success"}),e._v(" "),n("span",[e._v(e._s(e.$t("chaoxingScore.importSuccessTip",[e.validateSummary.correctCount])))])]),e._v(" "),e.validateSummary.validateRecords.length?n("ValidateResult",{attrs:{result:e.validateSummary,full:!1}},[e._v("\n        "+e._s(e.$t("chaoxingScore.importErrorTip"))+"\n      ")]):e._e()],1)])])}),[],!1,null,"7faf17a8",null).exports},576608:function(){}}]);